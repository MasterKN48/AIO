{"version":3,"sources":["../node_modules/when/when.js","../node_modules/when/lib/TimeoutError.js","../node_modules/when/lib/state.js","../node_modules/when/lib/apply.js","../node_modules/ffmpeg/lib/utils.js","../node_modules/ffmpeg/index.js","../node_modules/ffmpeg/lib/ffmpeg.js","../node_modules/when/lib/decorators/timed.js","../node_modules/when/lib/decorators/array.js","../node_modules/when/lib/decorators/flow.js","../node_modules/when/lib/decorators/fold.js","../node_modules/when/lib/decorators/inspect.js","../node_modules/when/lib/decorators/iterate.js","../node_modules/when/lib/decorators/progress.js","../node_modules/when/lib/decorators/with.js","../node_modules/when/lib/decorators/unhandledRejection.js","../node_modules/when/lib/format.js","../node_modules/when/lib/Promise.js","../node_modules/when/lib/makePromise.js","../node_modules/when/lib/Scheduler.js","../node_modules/ffmpeg/lib/configs.js","../node_modules/ffmpeg/lib/video.js","../node_modules/ffmpeg/lib/presets.js","../node_modules/webpack/buildin/amd-define.js","../node_modules/when/lib/env.js","../node_modules/ffmpeg/lib/errors.js"],"names":["define","require","timed","array","flow","fold","inspect","generate","progress","withThis","unhandledRejection","TimeoutError","Promise","reduce","feature","apply","when","x","onFulfilled","onRejected","onProgress","p","resolve","arguments","length","then","lift","f","i","l","a","Array","this","attempt","Deferred","_defer","_handler","reject","notify","promise","resolver","iterate","unfold","join","all","promises","settle","any","some","race","map","mapFunc","filter","predicate","reduceRight","isPromiseLike","defer","message","Error","call","name","captureStackTrace","prototype","Object","create","constructor","pending","toPendingState","fulfilled","toFulfilledState","rejected","toRejectedState","handler","state","value","e","reason","makeApply","tryCatchResolve","thisArg","args","params","callAndResolve","c","h","callAndResolveNext","exec","fs","path","errors","module","exports","commands","settings","callback","finalCommand","timeoutID","process","error","stdout","stderr","clearTimeout","timeout","setTimeout","kill","isEmptyObj","obj","prop","hasOwnProperty","mergeObject","obj1","key","renderError","durationToSeconds","duration","parts","substr","split","parseInt","gcd","b","mkdir","dirpath","mode","position","normalize","slice","directory","charAt","existsSync","mkdirSync","in_array","utils","configs","video","_ffmpegInfoConfiguration","deferred","format","modules","encode","decode","configuration","match","indexModule","push","codecList","scope","replace","extension","_videoInfo","fileInput","filename","title","artist","album","track","date","is_synched","container","video_bitrate","video_stream","video_codec","resolution","pixel","aspect","fps","audio_stream","audio_codec","sample_rate","channels","audio_bitrate","rotate","ret","synched","raw","seconds","bitrate","stream","parseFloat","codec","w","resolutionSquare","audio","stereo","mono","aspectValue","y","string","gcdValue","pixelString","pixelValue","_getInformation","deferreds","__constructor","undefined","inputFilepath","data","env","ms","setTimer","handleDelay","resolveDelay","onTimeout","delay","_beget","t","visit","clearTimer","applier","applyFold","toPromise","ar","arr","become","_visitRemaining","handleFulfill","handleReject","RangeError","resolved","n","nReject","results","nFulfill","Math","max","min","fulfill","settleOne","_traverse","keep","filtered","j","filterSync","liftCombine","spread","_unreport","z","origCatch","createCatchFilter","isError","evaluatePredicate","runSideEffect","propagate","result","propagateValue","done","onResult","onError","receiver","otherwise","ensure","rejectInvalidPredicate","identity","orElse","defaultValue","tap","onFulfilledSideEffect","TypeError","to","condition","unspool","seed","next","item","newSeed","child","chain","localConsole","logError","noop","logInfo","console","log","info","onPotentiallyUnhandledRejection","rejection","enqueue","report","onPotentiallyUnhandledRejectionHandled","unreport","onFatalRejection","throwit","tasks","reported","running","r","handled","id","formatError","indexOf","splice","formatObject","flush","shift","s","stack","tryStringify","o","String","JSON","stringify","makePromise","scheduler","asap","environment","emitRejection","emit","type","self","CustomEvent","ignoredException","hasCustomEvent","ev","detail","bubbles","cancelable","dispatchEvent","document","createEvent","initCustomEvent","hasInternetExplorerCustomEvent","initEmitRejection","objectCreate","proto","Child","Handler","Pending","promiseReject","init","isPromise","Async","getHandler","Rejected","never","foreverPendingPromise","traverseWith","tryMap","traverseAt","settleAt","Fulfilled","maybeThenable","getHandlerUntrusted","getHandlerMaybeThenable","visitRemaining","start","markAsHandled","untrustedThen","Thenable","FailIfRejected","parent","context","begetFrom","snd","runRace","tryCatch2","fail","_report","_state","failIfRejected","Fold","inherit","inheritedContext","createContext","consumers","thenable","AssimilateTask","run","q","continuation","ContinuationTask","ProgressTask","enterContext","tryCatchReject3","exitContext","runContinuation3","cont","runContinuation1","errorId","ReportTask","UnreportTask","afterQueue","foreverPendingHandler","_then","tryCatchReject","runNotify","tryCatchReturn","Parent","tryAssimilate","Scheduler","async","_async","_running","_queue","_queueLen","_afterQueue","_afterQueueLen","drain","_drain","task","encoding","maxBuffer","presets","filePath","infoConfiguration","infoFile","file_path","info_configuration","metadata","inputs","filtersComlpex","output","options","addCommand","command","argument","addInput","addFilterComplex","setOutput","setDisableAudio","disabled","setDisableVideo","setVideoFormat","setVideoCodec","setVideoBitRate","setVideoFrameRate","framerate","setVideoStartTime","time","isNaN","startTime","setVideoDuration","setVideoAspectRatio","check","setVideoSize","size","keepPixelAspectRatio","keepAspectRatio","paddingColor","setAudioCodec","setAudioFrequency","frequency","setAudioChannels","channel","audio_channel","setAudioBitRate","setAudioQuality","quality","setWatermark","watermarkPath","baseSettings","margin_nord","margin_sud","margin_east","margin_west","overlay","getSing","val","inverse","toString","abs","getHorizontalMargins","east","west","getVerticalMargins","nord","sud","watermark","save","destionationFileName","newDimension","_calculateNewDimension","width","height","execCommand","resetCommands","referrerResolution","fixedWidth","fixedHeight","percentage","classicSize","round","ratio","folder","onlyDestinationFile","finalCommands","concat","readdirSync","fnExtractSoundToMP3","unlinkSync","destinationDirName","dirname","destinationFileNameWE","basename","extname","finalPath","fnExtractFrameToJPG","destinationFolder","newSettings","start_time","duration_time","frame_rate","number","every_n_frames","every_n_seconds","every_n_percentage","keep_pixel_aspect_ratio","keep_aspect_ratio","padding_color","file_name","every_n_check","replacements","Date","getTime","fnAddWatermark","newFilepath","MutationObs","capturedSetTimeout","nextTick","MutationObserver","WebKitMutationObserver","scheduled","node","createTextNode","observe","characterData","initMutationObserver","vertx","vertxRequire","cancelTimer","runOnLoop","runOnContext","util","list","codeName","msg","code"],"mappings":"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","file":"static/js/4.773c6e88.chunk.js","sourcesContent":["/** @license MIT License (c) copyright 2010-2014 original author or authors */\n\n/**\n * Promises/A+ and when() implementation\n * when is part of the cujoJS family of libraries (http://cujojs.com/)\n * @author Brian Cavalier\n * @author John Hann\n */\n(function(define) { 'use strict';\ndefine(function (require) {\n\n\tvar timed = require('./lib/decorators/timed');\n\tvar array = require('./lib/decorators/array');\n\tvar flow = require('./lib/decorators/flow');\n\tvar fold = require('./lib/decorators/fold');\n\tvar inspect = require('./lib/decorators/inspect');\n\tvar generate = require('./lib/decorators/iterate');\n\tvar progress = require('./lib/decorators/progress');\n\tvar withThis = require('./lib/decorators/with');\n\tvar unhandledRejection = require('./lib/decorators/unhandledRejection');\n\tvar TimeoutError = require('./lib/TimeoutError');\n\n\tvar Promise = [array, flow, fold, generate, progress,\n\t\tinspect, withThis, timed, unhandledRejection]\n\t\t.reduce(function(Promise, feature) {\n\t\t\treturn feature(Promise);\n\t\t}, require('./lib/Promise'));\n\n\tvar apply = require('./lib/apply')(Promise);\n\n\t// Public API\n\n\twhen.promise     = promise;              // Create a pending promise\n\twhen.resolve     = Promise.resolve;      // Create a resolved promise\n\twhen.reject      = Promise.reject;       // Create a rejected promise\n\n\twhen.lift        = lift;                 // lift a function to return promises\n\twhen['try']      = attempt;              // call a function and return a promise\n\twhen.attempt     = attempt;              // alias for when.try\n\n\twhen.iterate     = Promise.iterate;      // DEPRECATED (use cujojs/most streams) Generate a stream of promises\n\twhen.unfold      = Promise.unfold;       // DEPRECATED (use cujojs/most streams) Generate a stream of promises\n\n\twhen.join        = join;                 // Join 2 or more promises\n\n\twhen.all         = all;                  // Resolve a list of promises\n\twhen.settle      = settle;               // Settle a list of promises\n\n\twhen.any         = lift(Promise.any);    // One-winner race\n\twhen.some        = lift(Promise.some);   // Multi-winner race\n\twhen.race        = lift(Promise.race);   // First-to-settle race\n\n\twhen.map         = map;                  // Array.map() for promises\n\twhen.filter      = filter;               // Array.filter() for promises\n\twhen.reduce      = lift(Promise.reduce);       // Array.reduce() for promises\n\twhen.reduceRight = lift(Promise.reduceRight);  // Array.reduceRight() for promises\n\n\twhen.isPromiseLike = isPromiseLike;      // Is something promise-like, aka thenable\n\n\twhen.Promise     = Promise;              // Promise constructor\n\twhen.defer       = defer;                // Create a {promise, resolve, reject} tuple\n\n\t// Error types\n\n\twhen.TimeoutError = TimeoutError;\n\n\t/**\n\t * Get a trusted promise for x, or by transforming x with onFulfilled\n\t *\n\t * @param {*} x\n\t * @param {function?} onFulfilled callback to be called when x is\n\t *   successfully fulfilled.  If promiseOrValue is an immediate value, callback\n\t *   will be invoked immediately.\n\t * @param {function?} onRejected callback to be called when x is\n\t *   rejected.\n\t * @param {function?} onProgress callback to be called when progress updates\n\t *   are issued for x. @deprecated\n\t * @returns {Promise} a new promise that will fulfill with the return\n\t *   value of callback or errback or the completion value of promiseOrValue if\n\t *   callback and/or errback is not supplied.\n\t */\n\tfunction when(x, onFulfilled, onRejected, onProgress) {\n\t\tvar p = Promise.resolve(x);\n\t\tif (arguments.length < 2) {\n\t\t\treturn p;\n\t\t}\n\n\t\treturn p.then(onFulfilled, onRejected, onProgress);\n\t}\n\n\t/**\n\t * Creates a new promise whose fate is determined by resolver.\n\t * @param {function} resolver function(resolve, reject, notify)\n\t * @returns {Promise} promise whose fate is determine by resolver\n\t */\n\tfunction promise(resolver) {\n\t\treturn new Promise(resolver);\n\t}\n\n\t/**\n\t * Lift the supplied function, creating a version of f that returns\n\t * promises, and accepts promises as arguments.\n\t * @param {function} f\n\t * @returns {Function} version of f that returns promises\n\t */\n\tfunction lift(f) {\n\t\treturn function() {\n\t\t\tfor(var i=0, l=arguments.length, a=new Array(l); i<l; ++i) {\n\t\t\t\ta[i] = arguments[i];\n\t\t\t}\n\t\t\treturn apply(f, this, a);\n\t\t};\n\t}\n\n\t/**\n\t * Call f in a future turn, with the supplied args, and return a promise\n\t * for the result.\n\t * @param {function} f\n\t * @returns {Promise}\n\t */\n\tfunction attempt(f /*, args... */) {\n\t\t/*jshint validthis:true */\n\t\tfor(var i=0, l=arguments.length-1, a=new Array(l); i<l; ++i) {\n\t\t\ta[i] = arguments[i+1];\n\t\t}\n\t\treturn apply(f, this, a);\n\t}\n\n\t/**\n\t * Creates a {promise, resolver} pair, either or both of which\n\t * may be given out safely to consumers.\n\t * @return {{promise: Promise, resolve: function, reject: function, notify: function}}\n\t */\n\tfunction defer() {\n\t\treturn new Deferred();\n\t}\n\n\tfunction Deferred() {\n\t\tvar p = Promise._defer();\n\n\t\tfunction resolve(x) { p._handler.resolve(x); }\n\t\tfunction reject(x) { p._handler.reject(x); }\n\t\tfunction notify(x) { p._handler.notify(x); }\n\n\t\tthis.promise = p;\n\t\tthis.resolve = resolve;\n\t\tthis.reject = reject;\n\t\tthis.notify = notify;\n\t\tthis.resolver = { resolve: resolve, reject: reject, notify: notify };\n\t}\n\n\t/**\n\t * Determines if x is promise-like, i.e. a thenable object\n\t * NOTE: Will return true for *any thenable object*, and isn't truly\n\t * safe, since it may attempt to access the `then` property of x (i.e.\n\t *  clever/malicious getters may do weird things)\n\t * @param {*} x anything\n\t * @returns {boolean} true if x is promise-like\n\t */\n\tfunction isPromiseLike(x) {\n\t\treturn x && typeof x.then === 'function';\n\t}\n\n\t/**\n\t * Return a promise that will resolve only once all the supplied arguments\n\t * have resolved. The resolution value of the returned promise will be an array\n\t * containing the resolution values of each of the arguments.\n\t * @param {...*} arguments may be a mix of promises and values\n\t * @returns {Promise}\n\t */\n\tfunction join(/* ...promises */) {\n\t\treturn Promise.all(arguments);\n\t}\n\n\t/**\n\t * Return a promise that will fulfill once all input promises have\n\t * fulfilled, or reject when any one input promise rejects.\n\t * @param {array|Promise} promises array (or promise for an array) of promises\n\t * @returns {Promise}\n\t */\n\tfunction all(promises) {\n\t\treturn when(promises, Promise.all);\n\t}\n\n\t/**\n\t * Return a promise that will always fulfill with an array containing\n\t * the outcome states of all input promises.  The returned promise\n\t * will only reject if `promises` itself is a rejected promise.\n\t * @param {array|Promise} promises array (or promise for an array) of promises\n\t * @returns {Promise} promise for array of settled state descriptors\n\t */\n\tfunction settle(promises) {\n\t\treturn when(promises, Promise.settle);\n\t}\n\n\t/**\n\t * Promise-aware array map function, similar to `Array.prototype.map()`,\n\t * but input array may contain promises or values.\n\t * @param {Array|Promise} promises array of anything, may contain promises and values\n\t * @param {function(x:*, index:Number):*} mapFunc map function which may\n\t *  return a promise or value\n\t * @returns {Promise} promise that will fulfill with an array of mapped values\n\t *  or reject if any input promise rejects.\n\t */\n\tfunction map(promises, mapFunc) {\n\t\treturn when(promises, function(promises) {\n\t\t\treturn Promise.map(promises, mapFunc);\n\t\t});\n\t}\n\n\t/**\n\t * Filter the provided array of promises using the provided predicate.  Input may\n\t * contain promises and values\n\t * @param {Array|Promise} promises array of promises and values\n\t * @param {function(x:*, index:Number):boolean} predicate filtering predicate.\n\t *  Must return truthy (or promise for truthy) for items to retain.\n\t * @returns {Promise} promise that will fulfill with an array containing all items\n\t *  for which predicate returned truthy.\n\t */\n\tfunction filter(promises, predicate) {\n\t\treturn when(promises, function(promises) {\n\t\t\treturn Promise.filter(promises, predicate);\n\t\t});\n\t}\n\n\treturn when;\n});\n})(typeof define === 'function' && define.amd ? define : function (factory) { module.exports = factory(require); });\n","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function() {\n\n\t/**\n\t * Custom error type for promises rejected by promise.timeout\n\t * @param {string} message\n\t * @constructor\n\t */\n\tfunction TimeoutError (message) {\n\t\tError.call(this);\n\t\tthis.message = message;\n\t\tthis.name = TimeoutError.name;\n\t\tif (typeof Error.captureStackTrace === 'function') {\n\t\t\tError.captureStackTrace(this, TimeoutError);\n\t\t}\n\t}\n\n\tTimeoutError.prototype = Object.create(Error.prototype);\n\tTimeoutError.prototype.constructor = TimeoutError;\n\n\treturn TimeoutError;\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(); }));","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function() {\n\n\treturn {\n\t\tpending: toPendingState,\n\t\tfulfilled: toFulfilledState,\n\t\trejected: toRejectedState,\n\t\tinspect: inspect\n\t};\n\n\tfunction toPendingState() {\n\t\treturn { state: 'pending' };\n\t}\n\n\tfunction toRejectedState(e) {\n\t\treturn { state: 'rejected', reason: e };\n\t}\n\n\tfunction toFulfilledState(x) {\n\t\treturn { state: 'fulfilled', value: x };\n\t}\n\n\tfunction inspect(handler) {\n\t\tvar state = handler.state();\n\t\treturn state === 0 ? toPendingState()\n\t\t\t : state > 0   ? toFulfilledState(handler.value)\n\t\t\t               : toRejectedState(handler.value);\n\t}\n\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(); }));\n","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function() {\n\n\tmakeApply.tryCatchResolve = tryCatchResolve;\n\n\treturn makeApply;\n\n\tfunction makeApply(Promise, call) {\n\t\tif(arguments.length < 2) {\n\t\t\tcall = tryCatchResolve;\n\t\t}\n\n\t\treturn apply;\n\n\t\tfunction apply(f, thisArg, args) {\n\t\t\tvar p = Promise._defer();\n\t\t\tvar l = args.length;\n\t\t\tvar params = new Array(l);\n\t\t\tcallAndResolve({ f:f, thisArg:thisArg, args:args, params:params, i:l-1, call:call }, p._handler);\n\n\t\t\treturn p;\n\t\t}\n\n\t\tfunction callAndResolve(c, h) {\n\t\t\tif(c.i < 0) {\n\t\t\t\treturn call(c.f, c.thisArg, c.params, h);\n\t\t\t}\n\n\t\t\tvar handler = Promise._handler(c.args[c.i]);\n\t\t\thandler.fold(callAndResolveNext, c, void 0, h);\n\t\t}\n\n\t\tfunction callAndResolveNext(c, x, h) {\n\t\t\tc.params[c.i] = x;\n\t\t\tc.i -= 1;\n\t\t\tcallAndResolve(c, h);\n\t\t}\n\t}\n\n\tfunction tryCatchResolve(f, thisArg, args, resolver) {\n\t\ttry {\n\t\t\tresolver.resolve(f.apply(thisArg, args));\n\t\t} catch(e) {\n\t\t\tresolver.reject(e);\n\t\t}\n\t}\n\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(); }));\n\n\n","var exec\t= require('child_process').exec\n  , fs\t\t= require('fs')\n  , path\t= require('path');\n\nvar errors\t= require('./errors');\n\n/**\n * Exec the list of commands and call the callback function at the end of the process\n */\nmodule.exports.exec = function (commands, settings, callback) {\n\t// Create final command line\n\tvar finalCommand = commands.join(\" \");\n\t// Create the timeoutId for stop the timeout at the end the process\n\tvar timeoutID = null;\n\t// Exec the command\n\tvar process = exec(finalCommand, settings, function (error, stdout, stderr) {\n\t\t// Clear timeout if 'timeoutID' are setted\n\t\tif (timeoutID !== null) clearTimeout(timeoutID);\n\t\t// Call the callback function\n\t\tcallback(error, stdout, stderr);\n\t});\n\t// Verify if the timeout are setting\n\tif (settings.timeout > 0) {\n\t\t// Set the timeout\n\t\ttimeoutID = setTimeout(function () {\n\t\t\tprocess.kill();\n\t\t}, 100);\t\t\n\t}\n}\n\n/**\n * Check if object is empty\n */\nmodule.exports.isEmptyObj = function (obj) {\n\t// Scan all properties\n    for(var prop in obj)\n\t\t// Check if obj has a property\n        if(obj.hasOwnProperty(prop))\n\t\t\t// The object is not empty\n            return false;\n\t// The object is empty\n    return true;\n}\n\n/**\n * Merge obj1 into obj\n */\nmodule.exports.mergeObject = function (obj, obj1) {\n\t// Check if there are options set\n\tif (!module.exports.isEmptyObj(obj1)) {\n\t\t// Scan all settings\n\t\tfor (var key in obj1) {\n\t\t\t// Check if the option is valid\n\t\t\tif (!obj.hasOwnProperty(key))\n\t\t\t\tthrow errors.renderError('invalid_option_name', key);\n\t\t\t// Set new option value\n\t\t\tobj[key] = obj1[key];\n\t\t}\n\t}\n}\n\n/**\n * Calculate the duration in seconds from the string retrieved by the ffmpeg info\n */\nmodule.exports.durationToSeconds = function(duration) {\n\tvar parts = duration.substr(0,8).split(':');\n\treturn parseInt(parts[0], 10) * 3600 + parseInt(parts[1], 10) * 60 + parseInt(parts[2], 10);\n};\n\n/**\n * Calculate the greatest common divisor\n */\nmodule.exports.gcd = function (a, b) { \n\tif (b === 0) return a;\n\treturn module.exports.gcd(b, a % b);\n}\n\n/**\n * Offers functionality similar to mkdir -p\n */\nmodule.exports.mkdir = function (dirpath, mode, callback, position) {\n\t// Split all directories\n    var parts = path.normalize(dirpath).split('/');\n\t// If the first part is empty then remove this part\n\tif (parts[0] == \"\") \n\t\tparts = parts.slice(1);\n\t\n\t// Set the initial configuration\n    mode = mode || 0777;\n    position = position || 0;\n\t\n\t// Check se current position is greater than the list of folders\n\tif (position > parts.length) {\n\t\t// If isset the callback then it will be invoked\n\t\tif (callback) \n\t\t\tcallback();\n\t\t// Exit and return a positive value\n\t\treturn true;\n\t}\n\n\t// Build the directory path\n\tvar directory = (dirpath.charAt(0) == '/' ? '/' : '') + parts.slice(0, position + 1).join('/');\n\n\t// Check if directory exists\n\tif (fs.existsSync(directory)) {\n\t\tmodule.exports.mkdir(dirpath, mode, callback, position + 1);\n\t} else {\n\t\tif (fs.mkdirSync(directory, mode)) {\n\t\t\t// If isset the callback then it will be invoked\n\t\t\tif (callback) \n\t\t\t\tcallback(errors.renderError('mkdir', directory));\n\t\t\t// Send the new exception\n\t\t\tthrow errors.renderError('mkdir', directory);\n\t\t} else {\n\t\t\tmodule.exports.mkdir(dirpath, mode, callback, position + 1);\n\t\t}\n\t}\n}\n\n/**\n * Check if a value is present inside an array\n */\nmodule.exports.in_array = function (value, array) {\n\t// Scan all element\n\tfor (var i in array)\n\t\t// Check if value exists\n\t\tif (array[i] == value)\n\t\t\t// Return the position of value\n\t\t\treturn i;\n\t// The value not exists\n\treturn false;\n}","module.exports = require('./lib/ffmpeg');","var when\t\t= require('when')\n  , fs\t\t\t= require('fs');\n\nvar errors\t\t= require('./errors')\n  , utils\t\t= require('./utils')\n  , configs\t\t= require('./configs')\n  , video\t\t= require('./video');\n\nvar ffmpeg = function (/* inputFilepath, settings, callback */) {\n\n\t/**\n\t * Retrieve the list of the codec supported by the ffmpeg software\n\t */\n\tvar _ffmpegInfoConfiguration = function (settings) {\n\t\t// New 'promise' instance \n\t\tvar deferred = when.defer();\n\t\t// Instance the new arrays for the format\n\t\tvar format = { modules : new Array(), encode : new Array(), decode : new Array() };\n\t\t// Make the call to retrieve information about the ffmpeg\n\t\tutils.exec(['ffmpeg','-formats','2>&1'], settings, function (error, stdout, stderr) {\n\t\t\t// Get the list of modules\n\t\t\tvar configuration = /configuration:(.*)/.exec(stdout);\n\t\t\t// Check if exists the configuration\n\t\t\tif (configuration) {\n\t\t\t\t// Get the list of modules\n\t\t\t\tvar modules = configuration[1].match(/--enable-([a-zA-Z0-9\\-]+)/g);\n\t\t\t\t// Scan all modules\n\t\t\t\tfor (var indexModule in modules) {\n\t\t\t\t\t// Add module to the list\n\t\t\t\t\tformat.modules.push(/--enable-([a-zA-Z0-9\\-]+)/.exec(modules[indexModule])[1]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Get the codec list\n\t\t\tvar codecList = stdout.match(/ (DE|D|E) (.*) {1,} (.*)/g);\n\t\t\t// Scan all codec\n\t\t\tfor (var i in codecList) {\n\t\t\t\t// Get the match value\n\t\t\t\tvar match = / (DE|D|E) (.*) {1,} (.*)/.exec(codecList[i]);\n\t\t\t\t// Check if match is valid\n\t\t\t\tif (match) {\n\t\t\t\t\t// Get the value from the match\n\t\t\t\t\tvar scope = match[1].replace(/\\s/g,'')\n\t\t\t\t\t  , extension = match[2].replace(/\\s/g,'');\n\t\t\t\t\t// Check which scope is best suited\n\t\t\t\t\tif (scope == 'D' || scope == 'DE')\n\t\t\t\t\t\tformat.decode.push(extension);\n\t\t\t\t\tif (scope == 'E' || scope == 'DE')\n\t\t\t\t\t\tformat.encode.push(extension);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Returns the list of supported formats\n\t\t\tdeferred.resolve(format);\n\t\t});\n\t\t// Return 'promise' instance \n\t\treturn deferred.promise;\n\t}\n\t\n\t/**\n\t * Get the video info\n\t */\n\tvar _videoInfo = function (fileInput, settings) {\n\t\t// New 'promise' instance \n\t\tvar deferred = when.defer();\n\t\t// Make the call to retrieve information about the ffmpeg\n\t\tutils.exec(['ffmpeg','-i',fileInput,'2>&1'], settings, function (error, stdout, stderr) {\n\t\t\t// Perse output for retrieve the file info\n\t\t\tvar filename\t\t= /from \\'(.*)\\'/.exec(stdout) || []\n\t\t\t  , title\t\t\t= /(INAM|title)\\s+:\\s(.+)/.exec(stdout) || []\n\t\t\t  , artist\t\t\t= /artist\\s+:\\s(.+)/.exec(stdout) || []\n\t\t\t  , album\t\t\t= /album\\s+:\\s(.+)/.exec(stdout) || []\n\t\t\t  , track\t\t\t= /track\\s+:\\s(.+)/.exec(stdout) || []\n\t\t\t  , date\t\t\t= /date\\s+:\\s(.+)/.exec(stdout) || []\n\t\t\t  , is_synched\t\t= (/start: 0.000000/.exec(stdout) !== null)\n\t\t\t  , duration\t\t= /Duration: (([0-9]+):([0-9]{2}):([0-9]{2}).([0-9]+))/.exec(stdout) || []\n\t\t\t  \n\t\t\t  , container\t\t= /Input #0, ([a-zA-Z0-9]+),/.exec(stdout) || []\n\t\t\t  , video_bitrate\t= /bitrate: ([0-9]+) kb\\/s/.exec(stdout) || []\n\t\t\t  , video_stream\t= /Stream #([0-9\\.]+)([a-z0-9\\(\\)\\[\\]]*)[:] Video/.exec(stdout) || []\n\t\t\t  , video_codec\t\t= /Video: ([\\w]+)/.exec(stdout) || []\n\t\t\t  , resolution\t\t= /(([0-9]{2,5})x([0-9]{2,5}))/.exec(stdout) || []\n\t\t\t  , pixel\t\t\t= /[SP]AR ([0-9\\:]+)/.exec(stdout) || []\n\t\t\t  , aspect\t\t\t= /DAR ([0-9\\:]+)/.exec(stdout) || []\n\t\t\t  , fps\t\t\t\t= /([0-9\\.]+) (fps|tb\\(r\\))/.exec(stdout) || []\n\t\t\t  \n\t\t\t  , audio_stream\t= /Stream #([0-9\\.]+)([a-z0-9\\(\\)\\[\\]]*)[:] Audio/.exec(stdout) || []\n\t\t\t  , audio_codec\t\t= /Audio: ([\\w]+)/.exec(stdout) || []\n\t\t\t  , sample_rate\t\t= /([0-9]+) Hz/i.exec(stdout) || []\n\t\t\t  , channels\t\t= /Audio:.* (stereo|mono)/.exec(stdout) || []\n\t\t\t  , audio_bitrate\t= /Audio:.* ([0-9]+) kb\\/s/.exec(stdout) || []\n\t\t\t  , rotate\t\t\t= /rotate[\\s]+:[\\s]([\\d]{2,3})/.exec(stdout) || [];\n\t\t\t// Build return object\n\t\t\tvar ret = { \n\t\t\t\tfilename\t\t: filename[1] || ''\n\t\t\t  , title\t\t\t: title[2] || ''\n\t\t\t  , artist\t\t\t: artist[1] || ''\n\t\t\t  , album\t\t\t: album[1] || ''\n\t\t\t  , track\t\t\t: track[1] || ''\n\t\t\t  , date\t\t\t: date[1] || ''\n\t\t\t  , synched\t\t\t: is_synched\n\t\t\t  , duration\t\t: {\n\t\t\t\t\traw\t\t: duration[1] || ''\n\t\t\t\t  , seconds\t: duration[1] ? utils.durationToSeconds(duration[1]) : 0\n\t\t\t\t}\n\t\t\t  , video\t\t\t: {\n\t\t\t\t\tcontainer\t\t\t: container[1] || ''\n\t\t\t\t  , bitrate\t\t\t\t: (video_bitrate.length > 1) ? parseInt(video_bitrate[1], 10) : 0\n\t\t\t\t  , stream\t\t\t\t: video_stream.length > 1 ? parseFloat(video_stream[1]) : 0.0\n\t\t\t\t  , codec\t\t\t\t: video_codec[1] || ''\n\t\t\t\t  , resolution\t\t\t: {\n\t\t\t\t\t\tw : resolution.length > 2 ? parseInt(resolution[2], 10) : 0\n\t\t\t\t\t  , h : resolution.length > 3 ? parseInt(resolution[3], 10) : 0\n\t\t\t\t\t}\n\t\t\t\t  , resolutionSquare\t: {}\n\t\t\t\t  , aspect\t\t\t\t: {}\n\t\t\t\t  , rotate\t\t\t\t: rotate.length > 1 ? parseInt(rotate[1], 10) : 0\n\t\t\t\t  , fps\t\t\t\t\t: fps.length > 1 ? parseFloat(fps[1]) : 0.0\n\t\t\t\t}\n\t\t\t  , audio\t\t\t: {\n\t\t\t\t\tcodec\t\t\t\t: audio_codec[1] || ''\n\t\t\t\t  , bitrate\t\t\t\t: audio_bitrate[1] || ''\n\t\t\t\t  , sample_rate\t\t\t: sample_rate.length > 1 ? parseInt(sample_rate[1], 10) : 0\n\t\t\t\t  , stream\t\t\t\t: audio_stream.length > 1 ? parseFloat(audio_stream[1]) : 0.0\n\t\t\t\t  , channels\t\t\t: {\n\t\t\t\t\t\traw\t\t: channels[1] || ''\n\t\t\t\t\t  , value\t: (channels.length > 0) ? ({ stereo : 2, mono : 1 }[channels[1]] || 0) : ''\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\t// Check if exist aspect ratio\n\t\t\tif (aspect.length > 0) {\n\t\t\t\tvar aspectValue = aspect[1].split(\":\");\n\t\t\t\tret.video.aspect.x\t\t= parseInt(aspectValue[0], 10);\n\t\t\t\tret.video.aspect.y\t\t= parseInt(aspectValue[1], 10);\n\t\t\t\tret.video.aspect.string = aspect[1];\n\t\t\t\tret.video.aspect.value\t= parseFloat((ret.video.aspect.x / ret.video.aspect.y));\n\t\t\t} else {\n\t\t\t\t// If exists horizontal resolution then calculate aspect ratio\n\t\t\t\tif(ret.video.resolution.w > 0) {\n\t\t\t\t\tvar gcdValue = utils.gcd(ret.video.resolution.w, ret.video.resolution.h);\n\t\t\t\t\t// Calculate aspect ratio\n\t\t\t\t\tret.video.aspect.x\t\t= ret.video.resolution.w / gcdValue;\n\t\t\t\t\tret.video.aspect.y\t\t= ret.video.resolution.h / gcdValue;\n\t\t\t\t\tret.video.aspect.string = ret.video.aspect.x + ':' + ret.video.aspect.y;\n\t\t\t\t\tret.video.aspect.value\t= parseFloat((ret.video.aspect.x / ret.video.aspect.y));\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Save pixel ratio for output size calculation\n\t\t\tif (pixel.length > 0) {\n\t\t\t\tret.video.pixelString = pixel[1];\n\t\t\t\tvar pixelValue = pixel[1].split(\":\");\n\t\t\t\tret.video.pixel = parseFloat((parseInt(pixelValue[0], 10) / parseInt(pixelValue[1], 10)));\n\t\t\t} else {\n\t\t\t\tif (ret.video.resolution.w !== 0) {\n\t\t\t\t\tret.video.pixelString = '1:1';\n\t\t\t\t\tret.video.pixel = 1;\n\t\t\t\t} else {\n\t\t\t\t\tret.video.pixelString = '';\n\t\t\t\t\tret.video.pixel = 0.0;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Correct video.resolution when pixel aspectratio is not 1\n\t\t\tif (ret.video.pixel !== 1 || ret.video.pixel !== 0) {\n\t\t\t\tif( ret.video.pixel > 1 ) {\n\t\t\t\t\tret.video.resolutionSquare.w = parseInt(ret.video.resolution.w * ret.video.pixel, 10);\n\t\t\t\t\tret.video.resolutionSquare.h = ret.video.resolution.h;\n\t\t\t\t} else {\n\t\t\t\t\tret.video.resolutionSquare.w = ret.video.resolution.w;\n\t\t\t\t\tret.video.resolutionSquare.h = parseInt(ret.video.resolution.h / ret.video.pixel, 10);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Returns the list of supported formats\n\t\t\tdeferred.resolve(ret);\n\t\t});\n\t\t// Return 'promise' instance \n\t\treturn deferred.promise;\n\t}\n\t\n\t/**\n\t * Get the info about ffmpeg's codec and about file\n\t */\n\tvar _getInformation = function (fileInput, settings) {\n\t\tvar deferreds = [];\n\t\t// Add promise\n\t\tdeferreds.push(_ffmpegInfoConfiguration(settings));\n\t\tdeferreds.push(_videoInfo(fileInput, settings));\n\t\t// Return defer\n\t\treturn when.all(deferreds);\n\t}\n\n\tvar __constructor = function (args) {\n\t\t// Check if exist at least one option\n\t\tif (args.length == 0 || args[0] == undefined)\n\t\t\tthrow errors.renderError('empty_input_filepath');\n\t\t// Check if first argument is a string\n\t\tif (typeof args[0] != 'string')\n\t\t\tthrow errors.renderError('input_filepath_must_be_string');\n\t\t// Get the input filepath\n\t\tvar inputFilepath = args[0];\n\t\t// Check if file exist\n\t\tif (!fs.existsSync(inputFilepath))\n\t\t\tthrow errors.renderError('fileinput_not_exist');\n\t\t\n\t\t// New instance of the base configuration\n\t\tvar settings = new configs();\n\t\t// Callback to call\n\t\tvar callback = null;\n\t\t\n\t\t// Scan all arguments\n\t\tfor (var i = 1; i < args.length; i++) {\n\t\t\t// Check the type of variable\n\t\t\tswitch (typeof args[i]) {\n\t\t\t\tcase 'object' :\n\t\t\t\t\tutils.mergeObject(settings, args[i]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'function' :\n\t\t\t\t\tcallback = args[i];\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Building the value for return value. Check if the callback is not a function. In this case will created a new instance of the deferred class\n\t\tvar deferred = typeof callback != 'function' ? when.defer() : { promise : null };\n\t\t\n\t\twhen(_getInformation(inputFilepath, settings), function (data) {\n\t\t\t// Check if the callback is a function\n\t\t\tif (typeof callback == 'function') {\n\t\t\t\t// Call the callback function e return the new instance of 'video' class\n\t\t\t\tcallback(null, new video(inputFilepath, settings, data[0], data[1]));\n\t\t\t} else {\n\t\t\t\t// Positive response\n\t\t\t\tdeferred.resolve(new video(inputFilepath, settings, data[0], data[1]));\n\t\t\t}\n\t\t}, function (error) {\n\t\t\t// Check if the callback is a function\n\t\t\tif (typeof callback == 'function') {\n\t\t\t\t// Call the callback function e return the error found\n\t\t\t\tcallback(error, null);\n\t\t\t} else {\n\t\t\t\t// Negative response\n\t\t\t\tdeferred.reject(error);\n\t\t\t}\n\t\t});\n\t\t\n\t\t// Return a possible promise instance\n\t\treturn deferred.promise;\n\t}\n\n\treturn __constructor.call(this, arguments);\n};\n\nmodule.exports = ffmpeg;","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function(require) {\n\n\tvar env = require('../env');\n\tvar TimeoutError = require('../TimeoutError');\n\n\tfunction setTimeout(f, ms, x, y) {\n\t\treturn env.setTimer(function() {\n\t\t\tf(x, y, ms);\n\t\t}, ms);\n\t}\n\n\treturn function timed(Promise) {\n\t\t/**\n\t\t * Return a new promise whose fulfillment value is revealed only\n\t\t * after ms milliseconds\n\t\t * @param {number} ms milliseconds\n\t\t * @returns {Promise}\n\t\t */\n\t\tPromise.prototype.delay = function(ms) {\n\t\t\tvar p = this._beget();\n\t\t\tthis._handler.fold(handleDelay, ms, void 0, p._handler);\n\t\t\treturn p;\n\t\t};\n\n\t\tfunction handleDelay(ms, x, h) {\n\t\t\tsetTimeout(resolveDelay, ms, x, h);\n\t\t}\n\n\t\tfunction resolveDelay(x, h) {\n\t\t\th.resolve(x);\n\t\t}\n\n\t\t/**\n\t\t * Return a new promise that rejects after ms milliseconds unless\n\t\t * this promise fulfills earlier, in which case the returned promise\n\t\t * fulfills with the same value.\n\t\t * @param {number} ms milliseconds\n\t\t * @param {Error|*=} reason optional rejection reason to use, defaults\n\t\t *   to a TimeoutError if not provided\n\t\t * @returns {Promise}\n\t\t */\n\t\tPromise.prototype.timeout = function(ms, reason) {\n\t\t\tvar p = this._beget();\n\t\t\tvar h = p._handler;\n\n\t\t\tvar t = setTimeout(onTimeout, ms, reason, p._handler);\n\n\t\t\tthis._handler.visit(h,\n\t\t\t\tfunction onFulfill(x) {\n\t\t\t\t\tenv.clearTimer(t);\n\t\t\t\t\tthis.resolve(x); // this = h\n\t\t\t\t},\n\t\t\t\tfunction onReject(x) {\n\t\t\t\t\tenv.clearTimer(t);\n\t\t\t\t\tthis.reject(x); // this = h\n\t\t\t\t},\n\t\t\t\th.notify);\n\n\t\t\treturn p;\n\t\t};\n\n\t\tfunction onTimeout(reason, h, ms) {\n\t\t\tvar e = typeof reason === 'undefined'\n\t\t\t\t? new TimeoutError('timed out after ' + ms + 'ms')\n\t\t\t\t: reason;\n\t\t\th.reject(e);\n\t\t}\n\n\t\treturn Promise;\n\t};\n\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(require); }));\n","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function(require) {\n\n\tvar state = require('../state');\n\tvar applier = require('../apply');\n\n\treturn function array(Promise) {\n\n\t\tvar applyFold = applier(Promise);\n\t\tvar toPromise = Promise.resolve;\n\t\tvar all = Promise.all;\n\n\t\tvar ar = Array.prototype.reduce;\n\t\tvar arr = Array.prototype.reduceRight;\n\t\tvar slice = Array.prototype.slice;\n\n\t\t// Additional array combinators\n\n\t\tPromise.any = any;\n\t\tPromise.some = some;\n\t\tPromise.settle = settle;\n\n\t\tPromise.map = map;\n\t\tPromise.filter = filter;\n\t\tPromise.reduce = reduce;\n\t\tPromise.reduceRight = reduceRight;\n\n\t\t/**\n\t\t * When this promise fulfills with an array, do\n\t\t * onFulfilled.apply(void 0, array)\n\t\t * @param {function} onFulfilled function to apply\n\t\t * @returns {Promise} promise for the result of applying onFulfilled\n\t\t */\n\t\tPromise.prototype.spread = function(onFulfilled) {\n\t\t\treturn this.then(all).then(function(array) {\n\t\t\t\treturn onFulfilled.apply(this, array);\n\t\t\t});\n\t\t};\n\n\t\treturn Promise;\n\n\t\t/**\n\t\t * One-winner competitive race.\n\t\t * Return a promise that will fulfill when one of the promises\n\t\t * in the input array fulfills, or will reject when all promises\n\t\t * have rejected.\n\t\t * @param {array} promises\n\t\t * @returns {Promise} promise for the first fulfilled value\n\t\t */\n\t\tfunction any(promises) {\n\t\t\tvar p = Promise._defer();\n\t\t\tvar resolver = p._handler;\n\t\t\tvar l = promises.length>>>0;\n\n\t\t\tvar pending = l;\n\t\t\tvar errors = [];\n\n\t\t\tfor (var h, x, i = 0; i < l; ++i) {\n\t\t\t\tx = promises[i];\n\t\t\t\tif(x === void 0 && !(i in promises)) {\n\t\t\t\t\t--pending;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\th = Promise._handler(x);\n\t\t\t\tif(h.state() > 0) {\n\t\t\t\t\tresolver.become(h);\n\t\t\t\t\tPromise._visitRemaining(promises, i, h);\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\th.visit(resolver, handleFulfill, handleReject);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif(pending === 0) {\n\t\t\t\tresolver.reject(new RangeError('any(): array must not be empty'));\n\t\t\t}\n\n\t\t\treturn p;\n\n\t\t\tfunction handleFulfill(x) {\n\t\t\t\t/*jshint validthis:true*/\n\t\t\t\terrors = null;\n\t\t\t\tthis.resolve(x); // this === resolver\n\t\t\t}\n\n\t\t\tfunction handleReject(e) {\n\t\t\t\t/*jshint validthis:true*/\n\t\t\t\tif(this.resolved) { // this === resolver\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\terrors.push(e);\n\t\t\t\tif(--pending === 0) {\n\t\t\t\t\tthis.reject(errors);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * N-winner competitive race\n\t\t * Return a promise that will fulfill when n input promises have\n\t\t * fulfilled, or will reject when it becomes impossible for n\n\t\t * input promises to fulfill (ie when promises.length - n + 1\n\t\t * have rejected)\n\t\t * @param {array} promises\n\t\t * @param {number} n\n\t\t * @returns {Promise} promise for the earliest n fulfillment values\n\t\t *\n\t\t * @deprecated\n\t\t */\n\t\tfunction some(promises, n) {\n\t\t\t/*jshint maxcomplexity:7*/\n\t\t\tvar p = Promise._defer();\n\t\t\tvar resolver = p._handler;\n\n\t\t\tvar results = [];\n\t\t\tvar errors = [];\n\n\t\t\tvar l = promises.length>>>0;\n\t\t\tvar nFulfill = 0;\n\t\t\tvar nReject;\n\t\t\tvar x, i; // reused in both for() loops\n\n\t\t\t// First pass: count actual array items\n\t\t\tfor(i=0; i<l; ++i) {\n\t\t\t\tx = promises[i];\n\t\t\t\tif(x === void 0 && !(i in promises)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t++nFulfill;\n\t\t\t}\n\n\t\t\t// Compute actual goals\n\t\t\tn = Math.max(n, 0);\n\t\t\tnReject = (nFulfill - n + 1);\n\t\t\tnFulfill = Math.min(n, nFulfill);\n\n\t\t\tif(n > nFulfill) {\n\t\t\t\tresolver.reject(new RangeError('some(): array must contain at least '\n\t\t\t\t+ n + ' item(s), but had ' + nFulfill));\n\t\t\t} else if(nFulfill === 0) {\n\t\t\t\tresolver.resolve(results);\n\t\t\t}\n\n\t\t\t// Second pass: observe each array item, make progress toward goals\n\t\t\tfor(i=0; i<l; ++i) {\n\t\t\t\tx = promises[i];\n\t\t\t\tif(x === void 0 && !(i in promises)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tPromise._handler(x).visit(resolver, fulfill, reject, resolver.notify);\n\t\t\t}\n\n\t\t\treturn p;\n\n\t\t\tfunction fulfill(x) {\n\t\t\t\t/*jshint validthis:true*/\n\t\t\t\tif(this.resolved) { // this === resolver\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tresults.push(x);\n\t\t\t\tif(--nFulfill === 0) {\n\t\t\t\t\terrors = null;\n\t\t\t\t\tthis.resolve(results);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction reject(e) {\n\t\t\t\t/*jshint validthis:true*/\n\t\t\t\tif(this.resolved) { // this === resolver\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\terrors.push(e);\n\t\t\t\tif(--nReject === 0) {\n\t\t\t\t\tresults = null;\n\t\t\t\t\tthis.reject(errors);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Apply f to the value of each promise in a list of promises\n\t\t * and return a new list containing the results.\n\t\t * @param {array} promises\n\t\t * @param {function(x:*, index:Number):*} f mapping function\n\t\t * @returns {Promise}\n\t\t */\n\t\tfunction map(promises, f) {\n\t\t\treturn Promise._traverse(f, promises);\n\t\t}\n\n\t\t/**\n\t\t * Filter the provided array of promises using the provided predicate.  Input may\n\t\t * contain promises and values\n\t\t * @param {Array} promises array of promises and values\n\t\t * @param {function(x:*, index:Number):boolean} predicate filtering predicate.\n\t\t *  Must return truthy (or promise for truthy) for items to retain.\n\t\t * @returns {Promise} promise that will fulfill with an array containing all items\n\t\t *  for which predicate returned truthy.\n\t\t */\n\t\tfunction filter(promises, predicate) {\n\t\t\tvar a = slice.call(promises);\n\t\t\treturn Promise._traverse(predicate, a).then(function(keep) {\n\t\t\t\treturn filterSync(a, keep);\n\t\t\t});\n\t\t}\n\n\t\tfunction filterSync(promises, keep) {\n\t\t\t// Safe because we know all promises have fulfilled if we've made it this far\n\t\t\tvar l = keep.length;\n\t\t\tvar filtered = new Array(l);\n\t\t\tfor(var i=0, j=0; i<l; ++i) {\n\t\t\t\tif(keep[i]) {\n\t\t\t\t\tfiltered[j++] = Promise._handler(promises[i]).value;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfiltered.length = j;\n\t\t\treturn filtered;\n\n\t\t}\n\n\t\t/**\n\t\t * Return a promise that will always fulfill with an array containing\n\t\t * the outcome states of all input promises.  The returned promise\n\t\t * will never reject.\n\t\t * @param {Array} promises\n\t\t * @returns {Promise} promise for array of settled state descriptors\n\t\t */\n\t\tfunction settle(promises) {\n\t\t\treturn all(promises.map(settleOne));\n\t\t}\n\n\t\tfunction settleOne(p) {\n\t\t\t// Optimize the case where we get an already-resolved when.js promise\n\t\t\t//  by extracting its state:\n\t\t\tvar handler;\n\t\t\tif (p instanceof Promise) {\n\t\t\t\t// This is our own Promise type and we can reach its handler internals:\n\t\t\t\thandler = p._handler.join();\n\t\t\t}\n\t\t\tif((handler && handler.state() === 0) || !handler) {\n\t\t\t\t// Either still pending, or not a Promise at all:\n\t\t\t\treturn toPromise(p).then(state.fulfilled, state.rejected);\n\t\t\t}\n\n\t\t\t// The promise is our own, but it is already resolved. Take a shortcut.\n\t\t\t// Since we're not actually handling the resolution, we need to disable\n\t\t\t// rejection reporting.\n\t\t\thandler._unreport();\n\t\t\treturn state.inspect(handler);\n\t\t}\n\n\t\t/**\n\t\t * Traditional reduce function, similar to `Array.prototype.reduce()`, but\n\t\t * input may contain promises and/or values, and reduceFunc\n\t\t * may return either a value or a promise, *and* initialValue may\n\t\t * be a promise for the starting value.\n\t\t * @param {Array|Promise} promises array or promise for an array of anything,\n\t\t *      may contain a mix of promises and values.\n\t\t * @param {function(accumulated:*, x:*, index:Number):*} f reduce function\n\t\t * @returns {Promise} that will resolve to the final reduced value\n\t\t */\n\t\tfunction reduce(promises, f /*, initialValue */) {\n\t\t\treturn arguments.length > 2 ? ar.call(promises, liftCombine(f), arguments[2])\n\t\t\t\t\t: ar.call(promises, liftCombine(f));\n\t\t}\n\n\t\t/**\n\t\t * Traditional reduce function, similar to `Array.prototype.reduceRight()`, but\n\t\t * input may contain promises and/or values, and reduceFunc\n\t\t * may return either a value or a promise, *and* initialValue may\n\t\t * be a promise for the starting value.\n\t\t * @param {Array|Promise} promises array or promise for an array of anything,\n\t\t *      may contain a mix of promises and values.\n\t\t * @param {function(accumulated:*, x:*, index:Number):*} f reduce function\n\t\t * @returns {Promise} that will resolve to the final reduced value\n\t\t */\n\t\tfunction reduceRight(promises, f /*, initialValue */) {\n\t\t\treturn arguments.length > 2 ? arr.call(promises, liftCombine(f), arguments[2])\n\t\t\t\t\t: arr.call(promises, liftCombine(f));\n\t\t}\n\n\t\tfunction liftCombine(f) {\n\t\t\treturn function(z, x, i) {\n\t\t\t\treturn applyFold(f, void 0, [z,x,i]);\n\t\t\t};\n\t\t}\n\t};\n\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(require); }));\n","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function() {\n\n\treturn function flow(Promise) {\n\n\t\tvar resolve = Promise.resolve;\n\t\tvar reject = Promise.reject;\n\t\tvar origCatch = Promise.prototype['catch'];\n\n\t\t/**\n\t\t * Handle the ultimate fulfillment value or rejection reason, and assume\n\t\t * responsibility for all errors.  If an error propagates out of result\n\t\t * or handleFatalError, it will be rethrown to the host, resulting in a\n\t\t * loud stack track on most platforms and a crash on some.\n\t\t * @param {function?} onResult\n\t\t * @param {function?} onError\n\t\t * @returns {undefined}\n\t\t */\n\t\tPromise.prototype.done = function(onResult, onError) {\n\t\t\tthis._handler.visit(this._handler.receiver, onResult, onError);\n\t\t};\n\n\t\t/**\n\t\t * Add Error-type and predicate matching to catch.  Examples:\n\t\t * promise.catch(TypeError, handleTypeError)\n\t\t *   .catch(predicate, handleMatchedErrors)\n\t\t *   .catch(handleRemainingErrors)\n\t\t * @param onRejected\n\t\t * @returns {*}\n\t\t */\n\t\tPromise.prototype['catch'] = Promise.prototype.otherwise = function(onRejected) {\n\t\t\tif (arguments.length < 2) {\n\t\t\t\treturn origCatch.call(this, onRejected);\n\t\t\t}\n\n\t\t\tif(typeof onRejected !== 'function') {\n\t\t\t\treturn this.ensure(rejectInvalidPredicate);\n\t\t\t}\n\n\t\t\treturn origCatch.call(this, createCatchFilter(arguments[1], onRejected));\n\t\t};\n\n\t\t/**\n\t\t * Wraps the provided catch handler, so that it will only be called\n\t\t * if the predicate evaluates truthy\n\t\t * @param {?function} handler\n\t\t * @param {function} predicate\n\t\t * @returns {function} conditional catch handler\n\t\t */\n\t\tfunction createCatchFilter(handler, predicate) {\n\t\t\treturn function(e) {\n\t\t\t\treturn evaluatePredicate(e, predicate)\n\t\t\t\t\t? handler.call(this, e)\n\t\t\t\t\t: reject(e);\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * Ensures that onFulfilledOrRejected will be called regardless of whether\n\t\t * this promise is fulfilled or rejected.  onFulfilledOrRejected WILL NOT\n\t\t * receive the promises' value or reason.  Any returned value will be disregarded.\n\t\t * onFulfilledOrRejected may throw or return a rejected promise to signal\n\t\t * an additional error.\n\t\t * @param {function} handler handler to be called regardless of\n\t\t *  fulfillment or rejection\n\t\t * @returns {Promise}\n\t\t */\n\t\tPromise.prototype['finally'] = Promise.prototype.ensure = function(handler) {\n\t\t\tif(typeof handler !== 'function') {\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\treturn this.then(function(x) {\n\t\t\t\treturn runSideEffect(handler, this, identity, x);\n\t\t\t}, function(e) {\n\t\t\t\treturn runSideEffect(handler, this, reject, e);\n\t\t\t});\n\t\t};\n\n\t\tfunction runSideEffect (handler, thisArg, propagate, value) {\n\t\t\tvar result = handler.call(thisArg);\n\t\t\treturn maybeThenable(result)\n\t\t\t\t? propagateValue(result, propagate, value)\n\t\t\t\t: propagate(value);\n\t\t}\n\n\t\tfunction propagateValue (result, propagate, x) {\n\t\t\treturn resolve(result).then(function () {\n\t\t\t\treturn propagate(x);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Recover from a failure by returning a defaultValue.  If defaultValue\n\t\t * is a promise, it's fulfillment value will be used.  If defaultValue is\n\t\t * a promise that rejects, the returned promise will reject with the\n\t\t * same reason.\n\t\t * @param {*} defaultValue\n\t\t * @returns {Promise} new promise\n\t\t */\n\t\tPromise.prototype['else'] = Promise.prototype.orElse = function(defaultValue) {\n\t\t\treturn this.then(void 0, function() {\n\t\t\t\treturn defaultValue;\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Shortcut for .then(function() { return value; })\n\t\t * @param  {*} value\n\t\t * @return {Promise} a promise that:\n\t\t *  - is fulfilled if value is not a promise, or\n\t\t *  - if value is a promise, will fulfill with its value, or reject\n\t\t *    with its reason.\n\t\t */\n\t\tPromise.prototype['yield'] = function(value) {\n\t\t\treturn this.then(function() {\n\t\t\t\treturn value;\n\t\t\t});\n\t\t};\n\n\t\t/**\n\t\t * Runs a side effect when this promise fulfills, without changing the\n\t\t * fulfillment value.\n\t\t * @param {function} onFulfilledSideEffect\n\t\t * @returns {Promise}\n\t\t */\n\t\tPromise.prototype.tap = function(onFulfilledSideEffect) {\n\t\t\treturn this.then(onFulfilledSideEffect)['yield'](this);\n\t\t};\n\n\t\treturn Promise;\n\t};\n\n\tfunction rejectInvalidPredicate() {\n\t\tthrow new TypeError('catch predicate must be a function');\n\t}\n\n\tfunction evaluatePredicate(e, predicate) {\n\t\treturn isError(predicate) ? e instanceof predicate : predicate(e);\n\t}\n\n\tfunction isError(predicate) {\n\t\treturn predicate === Error\n\t\t\t|| (predicate != null && predicate.prototype instanceof Error);\n\t}\n\n\tfunction maybeThenable(x) {\n\t\treturn (typeof x === 'object' || typeof x === 'function') && x !== null;\n\t}\n\n\tfunction identity(x) {\n\t\treturn x;\n\t}\n\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(); }));\n","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n/** @author Jeff Escalante */\n\n(function(define) { 'use strict';\ndefine(function() {\n\n\treturn function fold(Promise) {\n\n\t\tPromise.prototype.fold = function(f, z) {\n\t\t\tvar promise = this._beget();\n\n\t\t\tthis._handler.fold(function(z, x, to) {\n\t\t\t\tPromise._handler(z).fold(function(x, z, to) {\n\t\t\t\t\tto.resolve(f.call(this, z, x));\n\t\t\t\t}, x, this, to);\n\t\t\t}, z, promise._handler.receiver, promise._handler);\n\n\t\t\treturn promise;\n\t\t};\n\n\t\treturn Promise;\n\t};\n\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(); }));\n","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function(require) {\n\n\tvar inspect = require('../state').inspect;\n\n\treturn function inspection(Promise) {\n\n\t\tPromise.prototype.inspect = function() {\n\t\t\treturn inspect(Promise._handler(this));\n\t\t};\n\n\t\treturn Promise;\n\t};\n\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(require); }));\n","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function() {\n\n\treturn function generate(Promise) {\n\n\t\tvar resolve = Promise.resolve;\n\n\t\tPromise.iterate = iterate;\n\t\tPromise.unfold = unfold;\n\n\t\treturn Promise;\n\n\t\t/**\n\t\t * @deprecated Use github.com/cujojs/most streams and most.iterate\n\t\t * Generate a (potentially infinite) stream of promised values:\n\t\t * x, f(x), f(f(x)), etc. until condition(x) returns true\n\t\t * @param {function} f function to generate a new x from the previous x\n\t\t * @param {function} condition function that, given the current x, returns\n\t\t *  truthy when the iterate should stop\n\t\t * @param {function} handler function to handle the value produced by f\n\t\t * @param {*|Promise} x starting value, may be a promise\n\t\t * @return {Promise} the result of the last call to f before\n\t\t *  condition returns true\n\t\t */\n\t\tfunction iterate(f, condition, handler, x) {\n\t\t\treturn unfold(function(x) {\n\t\t\t\treturn [x, f(x)];\n\t\t\t}, condition, handler, x);\n\t\t}\n\n\t\t/**\n\t\t * @deprecated Use github.com/cujojs/most streams and most.unfold\n\t\t * Generate a (potentially infinite) stream of promised values\n\t\t * by applying handler(generator(seed)) iteratively until\n\t\t * condition(seed) returns true.\n\t\t * @param {function} unspool function that generates a [value, newSeed]\n\t\t *  given a seed.\n\t\t * @param {function} condition function that, given the current seed, returns\n\t\t *  truthy when the unfold should stop\n\t\t * @param {function} handler function to handle the value produced by unspool\n\t\t * @param x {*|Promise} starting value, may be a promise\n\t\t * @return {Promise} the result of the last value produced by unspool before\n\t\t *  condition returns true\n\t\t */\n\t\tfunction unfold(unspool, condition, handler, x) {\n\t\t\treturn resolve(x).then(function(seed) {\n\t\t\t\treturn resolve(condition(seed)).then(function(done) {\n\t\t\t\t\treturn done ? seed : resolve(unspool(seed)).spread(next);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tfunction next(item, newSeed) {\n\t\t\t\treturn resolve(handler(item)).then(function() {\n\t\t\t\t\treturn unfold(unspool, condition, handler, newSeed);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(); }));\n","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function() {\n\n\treturn function progress(Promise) {\n\n\t\t/**\n\t\t * @deprecated\n\t\t * Register a progress handler for this promise\n\t\t * @param {function} onProgress\n\t\t * @returns {Promise}\n\t\t */\n\t\tPromise.prototype.progress = function(onProgress) {\n\t\t\treturn this.then(void 0, void 0, onProgress);\n\t\t};\n\n\t\treturn Promise;\n\t};\n\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(); }));\n","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function() {\n\n\treturn function addWith(Promise) {\n\t\t/**\n\t\t * Returns a promise whose handlers will be called with `this` set to\n\t\t * the supplied receiver.  Subsequent promises derived from the\n\t\t * returned promise will also have their handlers called with receiver\n\t\t * as `this`. Calling `with` with undefined or no arguments will return\n\t\t * a promise whose handlers will again be called in the usual Promises/A+\n\t\t * way (no `this`) thus safely undoing any previous `with` in the\n\t\t * promise chain.\n\t\t *\n\t\t * WARNING: Promises returned from `with`/`withThis` are NOT Promises/A+\n\t\t * compliant, specifically violating 2.2.5 (http://promisesaplus.com/#point-41)\n\t\t *\n\t\t * @param {object} receiver `this` value for all handlers attached to\n\t\t *  the returned promise.\n\t\t * @returns {Promise}\n\t\t */\n\t\tPromise.prototype['with'] = Promise.prototype.withThis = function(receiver) {\n\t\t\tvar p = this._beget();\n\t\t\tvar child = p._handler;\n\t\t\tchild.receiver = receiver;\n\t\t\tthis._handler.chain(child, receiver);\n\t\t\treturn p;\n\t\t};\n\n\t\treturn Promise;\n\t};\n\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(); }));\n\n","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function(require) {\n\n\tvar setTimer = require('../env').setTimer;\n\tvar format = require('../format');\n\n\treturn function unhandledRejection(Promise) {\n\n\t\tvar logError = noop;\n\t\tvar logInfo = noop;\n\t\tvar localConsole;\n\n\t\tif(typeof console !== 'undefined') {\n\t\t\t// Alias console to prevent things like uglify's drop_console option from\n\t\t\t// removing console.log/error. Unhandled rejections fall into the same\n\t\t\t// category as uncaught exceptions, and build tools shouldn't silence them.\n\t\t\tlocalConsole = console;\n\t\t\tlogError = typeof localConsole.error !== 'undefined'\n\t\t\t\t? function (e) { localConsole.error(e); }\n\t\t\t\t: function (e) { localConsole.log(e); };\n\n\t\t\tlogInfo = typeof localConsole.info !== 'undefined'\n\t\t\t\t? function (e) { localConsole.info(e); }\n\t\t\t\t: function (e) { localConsole.log(e); };\n\t\t}\n\n\t\tPromise.onPotentiallyUnhandledRejection = function(rejection) {\n\t\t\tenqueue(report, rejection);\n\t\t};\n\n\t\tPromise.onPotentiallyUnhandledRejectionHandled = function(rejection) {\n\t\t\tenqueue(unreport, rejection);\n\t\t};\n\n\t\tPromise.onFatalRejection = function(rejection) {\n\t\t\tenqueue(throwit, rejection.value);\n\t\t};\n\n\t\tvar tasks = [];\n\t\tvar reported = [];\n\t\tvar running = null;\n\n\t\tfunction report(r) {\n\t\t\tif(!r.handled) {\n\t\t\t\treported.push(r);\n\t\t\t\tlogError('Potentially unhandled rejection [' + r.id + '] ' + format.formatError(r.value));\n\t\t\t}\n\t\t}\n\n\t\tfunction unreport(r) {\n\t\t\tvar i = reported.indexOf(r);\n\t\t\tif(i >= 0) {\n\t\t\t\treported.splice(i, 1);\n\t\t\t\tlogInfo('Handled previous rejection [' + r.id + '] ' + format.formatObject(r.value));\n\t\t\t}\n\t\t}\n\n\t\tfunction enqueue(f, x) {\n\t\t\ttasks.push(f, x);\n\t\t\tif(running === null) {\n\t\t\t\trunning = setTimer(flush, 0);\n\t\t\t}\n\t\t}\n\n\t\tfunction flush() {\n\t\t\trunning = null;\n\t\t\twhile(tasks.length > 0) {\n\t\t\t\ttasks.shift()(tasks.shift());\n\t\t\t}\n\t\t}\n\n\t\treturn Promise;\n\t};\n\n\tfunction throwit(e) {\n\t\tthrow e;\n\t}\n\n\tfunction noop() {}\n\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(require); }));\n","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function() {\n\n\treturn {\n\t\tformatError: formatError,\n\t\tformatObject: formatObject,\n\t\ttryStringify: tryStringify\n\t};\n\n\t/**\n\t * Format an error into a string.  If e is an Error and has a stack property,\n\t * it's returned.  Otherwise, e is formatted using formatObject, with a\n\t * warning added about e not being a proper Error.\n\t * @param {*} e\n\t * @returns {String} formatted string, suitable for output to developers\n\t */\n\tfunction formatError(e) {\n\t\tvar s = typeof e === 'object' && e !== null && (e.stack || e.message) ? e.stack || e.message : formatObject(e);\n\t\treturn e instanceof Error ? s : s + ' (WARNING: non-Error used)';\n\t}\n\n\t/**\n\t * Format an object, detecting \"plain\" objects and running them through\n\t * JSON.stringify if possible.\n\t * @param {Object} o\n\t * @returns {string}\n\t */\n\tfunction formatObject(o) {\n\t\tvar s = String(o);\n\t\tif(s === '[object Object]' && typeof JSON !== 'undefined') {\n\t\t\ts = tryStringify(o, s);\n\t\t}\n\t\treturn s;\n\t}\n\n\t/**\n\t * Try to return the result of JSON.stringify(x).  If that fails, return\n\t * defaultValue\n\t * @param {*} x\n\t * @param {*} defaultValue\n\t * @returns {String|*} JSON.stringify(x) or defaultValue\n\t */\n\tfunction tryStringify(x, defaultValue) {\n\t\ttry {\n\t\t\treturn JSON.stringify(x);\n\t\t} catch(e) {\n\t\t\treturn defaultValue;\n\t\t}\n\t}\n\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(); }));\n","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function (require) {\n\n\tvar makePromise = require('./makePromise');\n\tvar Scheduler = require('./Scheduler');\n\tvar async = require('./env').asap;\n\n\treturn makePromise({\n\t\tscheduler: new Scheduler(async)\n\t});\n\n});\n})(typeof define === 'function' && define.amd ? define : function (factory) { module.exports = factory(require); });\n","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function() {\n\n\treturn function makePromise(environment) {\n\n\t\tvar tasks = environment.scheduler;\n\t\tvar emitRejection = initEmitRejection();\n\n\t\tvar objectCreate = Object.create ||\n\t\t\tfunction(proto) {\n\t\t\t\tfunction Child() {}\n\t\t\t\tChild.prototype = proto;\n\t\t\t\treturn new Child();\n\t\t\t};\n\n\t\t/**\n\t\t * Create a promise whose fate is determined by resolver\n\t\t * @constructor\n\t\t * @returns {Promise} promise\n\t\t * @name Promise\n\t\t */\n\t\tfunction Promise(resolver, handler) {\n\t\t\tthis._handler = resolver === Handler ? handler : init(resolver);\n\t\t}\n\n\t\t/**\n\t\t * Run the supplied resolver\n\t\t * @param resolver\n\t\t * @returns {Pending}\n\t\t */\n\t\tfunction init(resolver) {\n\t\t\tvar handler = new Pending();\n\n\t\t\ttry {\n\t\t\t\tresolver(promiseResolve, promiseReject, promiseNotify);\n\t\t\t} catch (e) {\n\t\t\t\tpromiseReject(e);\n\t\t\t}\n\n\t\t\treturn handler;\n\n\t\t\t/**\n\t\t\t * Transition from pre-resolution state to post-resolution state, notifying\n\t\t\t * all listeners of the ultimate fulfillment or rejection\n\t\t\t * @param {*} x resolution value\n\t\t\t */\n\t\t\tfunction promiseResolve (x) {\n\t\t\t\thandler.resolve(x);\n\t\t\t}\n\t\t\t/**\n\t\t\t * Reject this promise with reason, which will be used verbatim\n\t\t\t * @param {Error|*} reason rejection reason, strongly suggested\n\t\t\t *   to be an Error type\n\t\t\t */\n\t\t\tfunction promiseReject (reason) {\n\t\t\t\thandler.reject(reason);\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * @deprecated\n\t\t\t * Issue a progress event, notifying all progress listeners\n\t\t\t * @param {*} x progress event payload to pass to all listeners\n\t\t\t */\n\t\t\tfunction promiseNotify (x) {\n\t\t\t\thandler.notify(x);\n\t\t\t}\n\t\t}\n\n\t\t// Creation\n\n\t\tPromise.resolve = resolve;\n\t\tPromise.reject = reject;\n\t\tPromise.never = never;\n\n\t\tPromise._defer = defer;\n\t\tPromise._handler = getHandler;\n\n\t\t/**\n\t\t * Returns a trusted promise. If x is already a trusted promise, it is\n\t\t * returned, otherwise returns a new trusted Promise which follows x.\n\t\t * @param  {*} x\n\t\t * @return {Promise} promise\n\t\t */\n\t\tfunction resolve(x) {\n\t\t\treturn isPromise(x) ? x\n\t\t\t\t: new Promise(Handler, new Async(getHandler(x)));\n\t\t}\n\n\t\t/**\n\t\t * Return a reject promise with x as its reason (x is used verbatim)\n\t\t * @param {*} x\n\t\t * @returns {Promise} rejected promise\n\t\t */\n\t\tfunction reject(x) {\n\t\t\treturn new Promise(Handler, new Async(new Rejected(x)));\n\t\t}\n\n\t\t/**\n\t\t * Return a promise that remains pending forever\n\t\t * @returns {Promise} forever-pending promise.\n\t\t */\n\t\tfunction never() {\n\t\t\treturn foreverPendingPromise; // Should be frozen\n\t\t}\n\n\t\t/**\n\t\t * Creates an internal {promise, resolver} pair\n\t\t * @private\n\t\t * @returns {Promise}\n\t\t */\n\t\tfunction defer() {\n\t\t\treturn new Promise(Handler, new Pending());\n\t\t}\n\n\t\t// Transformation and flow control\n\n\t\t/**\n\t\t * Transform this promise's fulfillment value, returning a new Promise\n\t\t * for the transformed result.  If the promise cannot be fulfilled, onRejected\n\t\t * is called with the reason.  onProgress *may* be called with updates toward\n\t\t * this promise's fulfillment.\n\t\t * @param {function=} onFulfilled fulfillment handler\n\t\t * @param {function=} onRejected rejection handler\n\t\t * @param {function=} onProgress @deprecated progress handler\n\t\t * @return {Promise} new promise\n\t\t */\n\t\tPromise.prototype.then = function(onFulfilled, onRejected, onProgress) {\n\t\t\tvar parent = this._handler;\n\t\t\tvar state = parent.join().state();\n\n\t\t\tif ((typeof onFulfilled !== 'function' && state > 0) ||\n\t\t\t\t(typeof onRejected !== 'function' && state < 0)) {\n\t\t\t\t// Short circuit: value will not change, simply share handler\n\t\t\t\treturn new this.constructor(Handler, parent);\n\t\t\t}\n\n\t\t\tvar p = this._beget();\n\t\t\tvar child = p._handler;\n\n\t\t\tparent.chain(child, parent.receiver, onFulfilled, onRejected, onProgress);\n\n\t\t\treturn p;\n\t\t};\n\n\t\t/**\n\t\t * If this promise cannot be fulfilled due to an error, call onRejected to\n\t\t * handle the error. Shortcut for .then(undefined, onRejected)\n\t\t * @param {function?} onRejected\n\t\t * @return {Promise}\n\t\t */\n\t\tPromise.prototype['catch'] = function(onRejected) {\n\t\t\treturn this.then(void 0, onRejected);\n\t\t};\n\n\t\t/**\n\t\t * Creates a new, pending promise of the same type as this promise\n\t\t * @private\n\t\t * @returns {Promise}\n\t\t */\n\t\tPromise.prototype._beget = function() {\n\t\t\treturn begetFrom(this._handler, this.constructor);\n\t\t};\n\n\t\tfunction begetFrom(parent, Promise) {\n\t\t\tvar child = new Pending(parent.receiver, parent.join().context);\n\t\t\treturn new Promise(Handler, child);\n\t\t}\n\n\t\t// Array combinators\n\n\t\tPromise.all = all;\n\t\tPromise.race = race;\n\t\tPromise._traverse = traverse;\n\n\t\t/**\n\t\t * Return a promise that will fulfill when all promises in the\n\t\t * input array have fulfilled, or will reject when one of the\n\t\t * promises rejects.\n\t\t * @param {array} promises array of promises\n\t\t * @returns {Promise} promise for array of fulfillment values\n\t\t */\n\t\tfunction all(promises) {\n\t\t\treturn traverseWith(snd, null, promises);\n\t\t}\n\n\t\t/**\n\t\t * Array<Promise<X>> -> Promise<Array<f(X)>>\n\t\t * @private\n\t\t * @param {function} f function to apply to each promise's value\n\t\t * @param {Array} promises array of promises\n\t\t * @returns {Promise} promise for transformed values\n\t\t */\n\t\tfunction traverse(f, promises) {\n\t\t\treturn traverseWith(tryCatch2, f, promises);\n\t\t}\n\n\t\tfunction traverseWith(tryMap, f, promises) {\n\t\t\tvar handler = typeof f === 'function' ? mapAt : settleAt;\n\n\t\t\tvar resolver = new Pending();\n\t\t\tvar pending = promises.length >>> 0;\n\t\t\tvar results = new Array(pending);\n\n\t\t\tfor (var i = 0, x; i < promises.length && !resolver.resolved; ++i) {\n\t\t\t\tx = promises[i];\n\n\t\t\t\tif (x === void 0 && !(i in promises)) {\n\t\t\t\t\t--pending;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\ttraverseAt(promises, handler, i, x, resolver);\n\t\t\t}\n\n\t\t\tif(pending === 0) {\n\t\t\t\tresolver.become(new Fulfilled(results));\n\t\t\t}\n\n\t\t\treturn new Promise(Handler, resolver);\n\n\t\t\tfunction mapAt(i, x, resolver) {\n\t\t\t\tif(!resolver.resolved) {\n\t\t\t\t\ttraverseAt(promises, settleAt, i, tryMap(f, x, i), resolver);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction settleAt(i, x, resolver) {\n\t\t\t\tresults[i] = x;\n\t\t\t\tif(--pending === 0) {\n\t\t\t\t\tresolver.become(new Fulfilled(results));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction traverseAt(promises, handler, i, x, resolver) {\n\t\t\tif (maybeThenable(x)) {\n\t\t\t\tvar h = getHandlerMaybeThenable(x);\n\t\t\t\tvar s = h.state();\n\n\t\t\t\tif (s === 0) {\n\t\t\t\t\th.fold(handler, i, void 0, resolver);\n\t\t\t\t} else if (s > 0) {\n\t\t\t\t\thandler(i, h.value, resolver);\n\t\t\t\t} else {\n\t\t\t\t\tresolver.become(h);\n\t\t\t\t\tvisitRemaining(promises, i+1, h);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\thandler(i, x, resolver);\n\t\t\t}\n\t\t}\n\n\t\tPromise._visitRemaining = visitRemaining;\n\t\tfunction visitRemaining(promises, start, handler) {\n\t\t\tfor(var i=start; i<promises.length; ++i) {\n\t\t\t\tmarkAsHandled(getHandler(promises[i]), handler);\n\t\t\t}\n\t\t}\n\n\t\tfunction markAsHandled(h, handler) {\n\t\t\tif(h === handler) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar s = h.state();\n\t\t\tif(s === 0) {\n\t\t\t\th.visit(h, void 0, h._unreport);\n\t\t\t} else if(s < 0) {\n\t\t\t\th._unreport();\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Fulfill-reject competitive race. Return a promise that will settle\n\t\t * to the same state as the earliest input promise to settle.\n\t\t *\n\t\t * WARNING: The ES6 Promise spec requires that race()ing an empty array\n\t\t * must return a promise that is pending forever.  This implementation\n\t\t * returns a singleton forever-pending promise, the same singleton that is\n\t\t * returned by Promise.never(), thus can be checked with ===\n\t\t *\n\t\t * @param {array} promises array of promises to race\n\t\t * @returns {Promise} if input is non-empty, a promise that will settle\n\t\t * to the same outcome as the earliest input promise to settle. if empty\n\t\t * is empty, returns a promise that will never settle.\n\t\t */\n\t\tfunction race(promises) {\n\t\t\tif(typeof promises !== 'object' || promises === null) {\n\t\t\t\treturn reject(new TypeError('non-iterable passed to race()'));\n\t\t\t}\n\n\t\t\t// Sigh, race([]) is untestable unless we return *something*\n\t\t\t// that is recognizable without calling .then() on it.\n\t\t\treturn promises.length === 0 ? never()\n\t\t\t\t : promises.length === 1 ? resolve(promises[0])\n\t\t\t\t : runRace(promises);\n\t\t}\n\n\t\tfunction runRace(promises) {\n\t\t\tvar resolver = new Pending();\n\t\t\tvar i, x, h;\n\t\t\tfor(i=0; i<promises.length; ++i) {\n\t\t\t\tx = promises[i];\n\t\t\t\tif (x === void 0 && !(i in promises)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\th = getHandler(x);\n\t\t\t\tif(h.state() !== 0) {\n\t\t\t\t\tresolver.become(h);\n\t\t\t\t\tvisitRemaining(promises, i+1, h);\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\th.visit(resolver, resolver.resolve, resolver.reject);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn new Promise(Handler, resolver);\n\t\t}\n\n\t\t// Promise internals\n\t\t// Below this, everything is @private\n\n\t\t/**\n\t\t * Get an appropriate handler for x, without checking for cycles\n\t\t * @param {*} x\n\t\t * @returns {object} handler\n\t\t */\n\t\tfunction getHandler(x) {\n\t\t\tif(isPromise(x)) {\n\t\t\t\treturn x._handler.join();\n\t\t\t}\n\t\t\treturn maybeThenable(x) ? getHandlerUntrusted(x) : new Fulfilled(x);\n\t\t}\n\n\t\t/**\n\t\t * Get a handler for thenable x.\n\t\t * NOTE: You must only call this if maybeThenable(x) == true\n\t\t * @param {object|function|Promise} x\n\t\t * @returns {object} handler\n\t\t */\n\t\tfunction getHandlerMaybeThenable(x) {\n\t\t\treturn isPromise(x) ? x._handler.join() : getHandlerUntrusted(x);\n\t\t}\n\n\t\t/**\n\t\t * Get a handler for potentially untrusted thenable x\n\t\t * @param {*} x\n\t\t * @returns {object} handler\n\t\t */\n\t\tfunction getHandlerUntrusted(x) {\n\t\t\ttry {\n\t\t\t\tvar untrustedThen = x.then;\n\t\t\t\treturn typeof untrustedThen === 'function'\n\t\t\t\t\t? new Thenable(untrustedThen, x)\n\t\t\t\t\t: new Fulfilled(x);\n\t\t\t} catch(e) {\n\t\t\t\treturn new Rejected(e);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Handler for a promise that is pending forever\n\t\t * @constructor\n\t\t */\n\t\tfunction Handler() {}\n\n\t\tHandler.prototype.when\n\t\t\t= Handler.prototype.become\n\t\t\t= Handler.prototype.notify // deprecated\n\t\t\t= Handler.prototype.fail\n\t\t\t= Handler.prototype._unreport\n\t\t\t= Handler.prototype._report\n\t\t\t= noop;\n\n\t\tHandler.prototype._state = 0;\n\n\t\tHandler.prototype.state = function() {\n\t\t\treturn this._state;\n\t\t};\n\n\t\t/**\n\t\t * Recursively collapse handler chain to find the handler\n\t\t * nearest to the fully resolved value.\n\t\t * @returns {object} handler nearest the fully resolved value\n\t\t */\n\t\tHandler.prototype.join = function() {\n\t\t\tvar h = this;\n\t\t\twhile(h.handler !== void 0) {\n\t\t\t\th = h.handler;\n\t\t\t}\n\t\t\treturn h;\n\t\t};\n\n\t\tHandler.prototype.chain = function(to, receiver, fulfilled, rejected, progress) {\n\t\t\tthis.when({\n\t\t\t\tresolver: to,\n\t\t\t\treceiver: receiver,\n\t\t\t\tfulfilled: fulfilled,\n\t\t\t\trejected: rejected,\n\t\t\t\tprogress: progress\n\t\t\t});\n\t\t};\n\n\t\tHandler.prototype.visit = function(receiver, fulfilled, rejected, progress) {\n\t\t\tthis.chain(failIfRejected, receiver, fulfilled, rejected, progress);\n\t\t};\n\n\t\tHandler.prototype.fold = function(f, z, c, to) {\n\t\t\tthis.when(new Fold(f, z, c, to));\n\t\t};\n\n\t\t/**\n\t\t * Handler that invokes fail() on any handler it becomes\n\t\t * @constructor\n\t\t */\n\t\tfunction FailIfRejected() {}\n\n\t\tinherit(Handler, FailIfRejected);\n\n\t\tFailIfRejected.prototype.become = function(h) {\n\t\t\th.fail();\n\t\t};\n\n\t\tvar failIfRejected = new FailIfRejected();\n\n\t\t/**\n\t\t * Handler that manages a queue of consumers waiting on a pending promise\n\t\t * @constructor\n\t\t */\n\t\tfunction Pending(receiver, inheritedContext) {\n\t\t\tPromise.createContext(this, inheritedContext);\n\n\t\t\tthis.consumers = void 0;\n\t\t\tthis.receiver = receiver;\n\t\t\tthis.handler = void 0;\n\t\t\tthis.resolved = false;\n\t\t}\n\n\t\tinherit(Handler, Pending);\n\n\t\tPending.prototype._state = 0;\n\n\t\tPending.prototype.resolve = function(x) {\n\t\t\tthis.become(getHandler(x));\n\t\t};\n\n\t\tPending.prototype.reject = function(x) {\n\t\t\tif(this.resolved) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.become(new Rejected(x));\n\t\t};\n\n\t\tPending.prototype.join = function() {\n\t\t\tif (!this.resolved) {\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tvar h = this;\n\n\t\t\twhile (h.handler !== void 0) {\n\t\t\t\th = h.handler;\n\t\t\t\tif (h === this) {\n\t\t\t\t\treturn this.handler = cycle();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn h;\n\t\t};\n\n\t\tPending.prototype.run = function() {\n\t\t\tvar q = this.consumers;\n\t\t\tvar handler = this.handler;\n\t\t\tthis.handler = this.handler.join();\n\t\t\tthis.consumers = void 0;\n\n\t\t\tfor (var i = 0; i < q.length; ++i) {\n\t\t\t\thandler.when(q[i]);\n\t\t\t}\n\t\t};\n\n\t\tPending.prototype.become = function(handler) {\n\t\t\tif(this.resolved) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.resolved = true;\n\t\t\tthis.handler = handler;\n\t\t\tif(this.consumers !== void 0) {\n\t\t\t\ttasks.enqueue(this);\n\t\t\t}\n\n\t\t\tif(this.context !== void 0) {\n\t\t\t\thandler._report(this.context);\n\t\t\t}\n\t\t};\n\n\t\tPending.prototype.when = function(continuation) {\n\t\t\tif(this.resolved) {\n\t\t\t\ttasks.enqueue(new ContinuationTask(continuation, this.handler));\n\t\t\t} else {\n\t\t\t\tif(this.consumers === void 0) {\n\t\t\t\t\tthis.consumers = [continuation];\n\t\t\t\t} else {\n\t\t\t\t\tthis.consumers.push(continuation);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * @deprecated\n\t\t */\n\t\tPending.prototype.notify = function(x) {\n\t\t\tif(!this.resolved) {\n\t\t\t\ttasks.enqueue(new ProgressTask(x, this));\n\t\t\t}\n\t\t};\n\n\t\tPending.prototype.fail = function(context) {\n\t\t\tvar c = typeof context === 'undefined' ? this.context : context;\n\t\t\tthis.resolved && this.handler.join().fail(c);\n\t\t};\n\n\t\tPending.prototype._report = function(context) {\n\t\t\tthis.resolved && this.handler.join()._report(context);\n\t\t};\n\n\t\tPending.prototype._unreport = function() {\n\t\t\tthis.resolved && this.handler.join()._unreport();\n\t\t};\n\n\t\t/**\n\t\t * Wrap another handler and force it into a future stack\n\t\t * @param {object} handler\n\t\t * @constructor\n\t\t */\n\t\tfunction Async(handler) {\n\t\t\tthis.handler = handler;\n\t\t}\n\n\t\tinherit(Handler, Async);\n\n\t\tAsync.prototype.when = function(continuation) {\n\t\t\ttasks.enqueue(new ContinuationTask(continuation, this));\n\t\t};\n\n\t\tAsync.prototype._report = function(context) {\n\t\t\tthis.join()._report(context);\n\t\t};\n\n\t\tAsync.prototype._unreport = function() {\n\t\t\tthis.join()._unreport();\n\t\t};\n\n\t\t/**\n\t\t * Handler that wraps an untrusted thenable and assimilates it in a future stack\n\t\t * @param {function} then\n\t\t * @param {{then: function}} thenable\n\t\t * @constructor\n\t\t */\n\t\tfunction Thenable(then, thenable) {\n\t\t\tPending.call(this);\n\t\t\ttasks.enqueue(new AssimilateTask(then, thenable, this));\n\t\t}\n\n\t\tinherit(Pending, Thenable);\n\n\t\t/**\n\t\t * Handler for a fulfilled promise\n\t\t * @param {*} x fulfillment value\n\t\t * @constructor\n\t\t */\n\t\tfunction Fulfilled(x) {\n\t\t\tPromise.createContext(this);\n\t\t\tthis.value = x;\n\t\t}\n\n\t\tinherit(Handler, Fulfilled);\n\n\t\tFulfilled.prototype._state = 1;\n\n\t\tFulfilled.prototype.fold = function(f, z, c, to) {\n\t\t\trunContinuation3(f, z, this, c, to);\n\t\t};\n\n\t\tFulfilled.prototype.when = function(cont) {\n\t\t\trunContinuation1(cont.fulfilled, this, cont.receiver, cont.resolver);\n\t\t};\n\n\t\tvar errorId = 0;\n\n\t\t/**\n\t\t * Handler for a rejected promise\n\t\t * @param {*} x rejection reason\n\t\t * @constructor\n\t\t */\n\t\tfunction Rejected(x) {\n\t\t\tPromise.createContext(this);\n\n\t\t\tthis.id = ++errorId;\n\t\t\tthis.value = x;\n\t\t\tthis.handled = false;\n\t\t\tthis.reported = false;\n\n\t\t\tthis._report();\n\t\t}\n\n\t\tinherit(Handler, Rejected);\n\n\t\tRejected.prototype._state = -1;\n\n\t\tRejected.prototype.fold = function(f, z, c, to) {\n\t\t\tto.become(this);\n\t\t};\n\n\t\tRejected.prototype.when = function(cont) {\n\t\t\tif(typeof cont.rejected === 'function') {\n\t\t\t\tthis._unreport();\n\t\t\t}\n\t\t\trunContinuation1(cont.rejected, this, cont.receiver, cont.resolver);\n\t\t};\n\n\t\tRejected.prototype._report = function(context) {\n\t\t\ttasks.afterQueue(new ReportTask(this, context));\n\t\t};\n\n\t\tRejected.prototype._unreport = function() {\n\t\t\tif(this.handled) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.handled = true;\n\t\t\ttasks.afterQueue(new UnreportTask(this));\n\t\t};\n\n\t\tRejected.prototype.fail = function(context) {\n\t\t\tthis.reported = true;\n\t\t\temitRejection('unhandledRejection', this);\n\t\t\tPromise.onFatalRejection(this, context === void 0 ? this.context : context);\n\t\t};\n\n\t\tfunction ReportTask(rejection, context) {\n\t\t\tthis.rejection = rejection;\n\t\t\tthis.context = context;\n\t\t}\n\n\t\tReportTask.prototype.run = function() {\n\t\t\tif(!this.rejection.handled && !this.rejection.reported) {\n\t\t\t\tthis.rejection.reported = true;\n\t\t\t\temitRejection('unhandledRejection', this.rejection) ||\n\t\t\t\t\tPromise.onPotentiallyUnhandledRejection(this.rejection, this.context);\n\t\t\t}\n\t\t};\n\n\t\tfunction UnreportTask(rejection) {\n\t\t\tthis.rejection = rejection;\n\t\t}\n\n\t\tUnreportTask.prototype.run = function() {\n\t\t\tif(this.rejection.reported) {\n\t\t\t\temitRejection('rejectionHandled', this.rejection) ||\n\t\t\t\t\tPromise.onPotentiallyUnhandledRejectionHandled(this.rejection);\n\t\t\t}\n\t\t};\n\n\t\t// Unhandled rejection hooks\n\t\t// By default, everything is a noop\n\n\t\tPromise.createContext\n\t\t\t= Promise.enterContext\n\t\t\t= Promise.exitContext\n\t\t\t= Promise.onPotentiallyUnhandledRejection\n\t\t\t= Promise.onPotentiallyUnhandledRejectionHandled\n\t\t\t= Promise.onFatalRejection\n\t\t\t= noop;\n\n\t\t// Errors and singletons\n\n\t\tvar foreverPendingHandler = new Handler();\n\t\tvar foreverPendingPromise = new Promise(Handler, foreverPendingHandler);\n\n\t\tfunction cycle() {\n\t\t\treturn new Rejected(new TypeError('Promise cycle'));\n\t\t}\n\n\t\t// Task runners\n\n\t\t/**\n\t\t * Run a single consumer\n\t\t * @constructor\n\t\t */\n\t\tfunction ContinuationTask(continuation, handler) {\n\t\t\tthis.continuation = continuation;\n\t\t\tthis.handler = handler;\n\t\t}\n\n\t\tContinuationTask.prototype.run = function() {\n\t\t\tthis.handler.join().when(this.continuation);\n\t\t};\n\n\t\t/**\n\t\t * Run a queue of progress handlers\n\t\t * @constructor\n\t\t */\n\t\tfunction ProgressTask(value, handler) {\n\t\t\tthis.handler = handler;\n\t\t\tthis.value = value;\n\t\t}\n\n\t\tProgressTask.prototype.run = function() {\n\t\t\tvar q = this.handler.consumers;\n\t\t\tif(q === void 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (var c, i = 0; i < q.length; ++i) {\n\t\t\t\tc = q[i];\n\t\t\t\trunNotify(c.progress, this.value, this.handler, c.receiver, c.resolver);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * Assimilate a thenable, sending it's value to resolver\n\t\t * @param {function} then\n\t\t * @param {object|function} thenable\n\t\t * @param {object} resolver\n\t\t * @constructor\n\t\t */\n\t\tfunction AssimilateTask(then, thenable, resolver) {\n\t\t\tthis._then = then;\n\t\t\tthis.thenable = thenable;\n\t\t\tthis.resolver = resolver;\n\t\t}\n\n\t\tAssimilateTask.prototype.run = function() {\n\t\t\tvar h = this.resolver;\n\t\t\ttryAssimilate(this._then, this.thenable, _resolve, _reject, _notify);\n\n\t\t\tfunction _resolve(x) { h.resolve(x); }\n\t\t\tfunction _reject(x)  { h.reject(x); }\n\t\t\tfunction _notify(x)  { h.notify(x); }\n\t\t};\n\n\t\tfunction tryAssimilate(then, thenable, resolve, reject, notify) {\n\t\t\ttry {\n\t\t\t\tthen.call(thenable, resolve, reject, notify);\n\t\t\t} catch (e) {\n\t\t\t\treject(e);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Fold a handler value with z\n\t\t * @constructor\n\t\t */\n\t\tfunction Fold(f, z, c, to) {\n\t\t\tthis.f = f; this.z = z; this.c = c; this.to = to;\n\t\t\tthis.resolver = failIfRejected;\n\t\t\tthis.receiver = this;\n\t\t}\n\n\t\tFold.prototype.fulfilled = function(x) {\n\t\t\tthis.f.call(this.c, this.z, x, this.to);\n\t\t};\n\n\t\tFold.prototype.rejected = function(x) {\n\t\t\tthis.to.reject(x);\n\t\t};\n\n\t\tFold.prototype.progress = function(x) {\n\t\t\tthis.to.notify(x);\n\t\t};\n\n\t\t// Other helpers\n\n\t\t/**\n\t\t * @param {*} x\n\t\t * @returns {boolean} true iff x is a trusted Promise\n\t\t */\n\t\tfunction isPromise(x) {\n\t\t\treturn x instanceof Promise;\n\t\t}\n\n\t\t/**\n\t\t * Test just enough to rule out primitives, in order to take faster\n\t\t * paths in some code\n\t\t * @param {*} x\n\t\t * @returns {boolean} false iff x is guaranteed *not* to be a thenable\n\t\t */\n\t\tfunction maybeThenable(x) {\n\t\t\treturn (typeof x === 'object' || typeof x === 'function') && x !== null;\n\t\t}\n\n\t\tfunction runContinuation1(f, h, receiver, next) {\n\t\t\tif(typeof f !== 'function') {\n\t\t\t\treturn next.become(h);\n\t\t\t}\n\n\t\t\tPromise.enterContext(h);\n\t\t\ttryCatchReject(f, h.value, receiver, next);\n\t\t\tPromise.exitContext();\n\t\t}\n\n\t\tfunction runContinuation3(f, x, h, receiver, next) {\n\t\t\tif(typeof f !== 'function') {\n\t\t\t\treturn next.become(h);\n\t\t\t}\n\n\t\t\tPromise.enterContext(h);\n\t\t\ttryCatchReject3(f, x, h.value, receiver, next);\n\t\t\tPromise.exitContext();\n\t\t}\n\n\t\t/**\n\t\t * @deprecated\n\t\t */\n\t\tfunction runNotify(f, x, h, receiver, next) {\n\t\t\tif(typeof f !== 'function') {\n\t\t\t\treturn next.notify(x);\n\t\t\t}\n\n\t\t\tPromise.enterContext(h);\n\t\t\ttryCatchReturn(f, x, receiver, next);\n\t\t\tPromise.exitContext();\n\t\t}\n\n\t\tfunction tryCatch2(f, a, b) {\n\t\t\ttry {\n\t\t\t\treturn f(a, b);\n\t\t\t} catch(e) {\n\t\t\t\treturn reject(e);\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Return f.call(thisArg, x), or if it throws return a rejected promise for\n\t\t * the thrown exception\n\t\t */\n\t\tfunction tryCatchReject(f, x, thisArg, next) {\n\t\t\ttry {\n\t\t\t\tnext.become(getHandler(f.call(thisArg, x)));\n\t\t\t} catch(e) {\n\t\t\t\tnext.become(new Rejected(e));\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Same as above, but includes the extra argument parameter.\n\t\t */\n\t\tfunction tryCatchReject3(f, x, y, thisArg, next) {\n\t\t\ttry {\n\t\t\t\tf.call(thisArg, x, y, next);\n\t\t\t} catch(e) {\n\t\t\t\tnext.become(new Rejected(e));\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * @deprecated\n\t\t * Return f.call(thisArg, x), or if it throws, *return* the exception\n\t\t */\n\t\tfunction tryCatchReturn(f, x, thisArg, next) {\n\t\t\ttry {\n\t\t\t\tnext.notify(f.call(thisArg, x));\n\t\t\t} catch(e) {\n\t\t\t\tnext.notify(e);\n\t\t\t}\n\t\t}\n\n\t\tfunction inherit(Parent, Child) {\n\t\t\tChild.prototype = objectCreate(Parent.prototype);\n\t\t\tChild.prototype.constructor = Child;\n\t\t}\n\n\t\tfunction snd(x, y) {\n\t\t\treturn y;\n\t\t}\n\n\t\tfunction noop() {}\n\n\t\tfunction hasCustomEvent() {\n\t\t\tif(typeof CustomEvent === 'function') {\n\t\t\t\ttry {\n\t\t\t\t\tvar ev = new CustomEvent('unhandledRejection');\n\t\t\t\t\treturn ev instanceof CustomEvent;\n\t\t\t\t} catch (ignoredException) {}\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction hasInternetExplorerCustomEvent() {\n\t\t\tif(typeof document !== 'undefined' && typeof document.createEvent === 'function') {\n\t\t\t\ttry {\n\t\t\t\t\t// Try to create one event to make sure it's supported\n\t\t\t\t\tvar ev = document.createEvent('CustomEvent');\n\t\t\t\t\tev.initCustomEvent('eventType', false, true, {});\n\t\t\t\t\treturn true;\n\t\t\t\t} catch (ignoredException) {}\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\tfunction initEmitRejection() {\n\t\t\t/*global process, self, CustomEvent*/\n\t\t\tif(typeof process !== 'undefined' && process !== null\n\t\t\t\t&& typeof process.emit === 'function') {\n\t\t\t\t// Returning falsy here means to call the default\n\t\t\t\t// onPotentiallyUnhandledRejection API.  This is safe even in\n\t\t\t\t// browserify since process.emit always returns falsy in browserify:\n\t\t\t\t// https://github.com/defunctzombie/node-process/blob/master/browser.js#L40-L46\n\t\t\t\treturn function(type, rejection) {\n\t\t\t\t\treturn type === 'unhandledRejection'\n\t\t\t\t\t\t? process.emit(type, rejection.value, rejection)\n\t\t\t\t\t\t: process.emit(type, rejection);\n\t\t\t\t};\n\t\t\t} else if(typeof self !== 'undefined' && hasCustomEvent()) {\n\t\t\t\treturn (function (self, CustomEvent) {\n\t\t\t\t\treturn function (type, rejection) {\n\t\t\t\t\t\tvar ev = new CustomEvent(type, {\n\t\t\t\t\t\t\tdetail: {\n\t\t\t\t\t\t\t\treason: rejection.value,\n\t\t\t\t\t\t\t\tkey: rejection\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbubbles: false,\n\t\t\t\t\t\t\tcancelable: true\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn !self.dispatchEvent(ev);\n\t\t\t\t\t};\n\t\t\t\t}(self, CustomEvent));\n\t\t\t} else if(typeof self !== 'undefined' && hasInternetExplorerCustomEvent()) {\n\t\t\t\treturn (function(self, document) {\n\t\t\t\t\treturn function(type, rejection) {\n\t\t\t\t\t\tvar ev = document.createEvent('CustomEvent');\n\t\t\t\t\t\tev.initCustomEvent(type, false, true, {\n\t\t\t\t\t\t\treason: rejection.value,\n\t\t\t\t\t\t\tkey: rejection\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn !self.dispatchEvent(ev);\n\t\t\t\t\t};\n\t\t\t\t}(self, document));\n\t\t\t}\n\n\t\t\treturn noop;\n\t\t}\n\n\t\treturn Promise;\n\t};\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(); }));\n","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n(function(define) { 'use strict';\ndefine(function() {\n\n\t// Credit to Twisol (https://github.com/Twisol) for suggesting\n\t// this type of extensible queue + trampoline approach for next-tick conflation.\n\n\t/**\n\t * Async task scheduler\n\t * @param {function} async function to schedule a single async function\n\t * @constructor\n\t */\n\tfunction Scheduler(async) {\n\t\tthis._async = async;\n\t\tthis._running = false;\n\n\t\tthis._queue = this;\n\t\tthis._queueLen = 0;\n\t\tthis._afterQueue = {};\n\t\tthis._afterQueueLen = 0;\n\n\t\tvar self = this;\n\t\tthis.drain = function() {\n\t\t\tself._drain();\n\t\t};\n\t}\n\n\t/**\n\t * Enqueue a task\n\t * @param {{ run:function }} task\n\t */\n\tScheduler.prototype.enqueue = function(task) {\n\t\tthis._queue[this._queueLen++] = task;\n\t\tthis.run();\n\t};\n\n\t/**\n\t * Enqueue a task to run after the main task queue\n\t * @param {{ run:function }} task\n\t */\n\tScheduler.prototype.afterQueue = function(task) {\n\t\tthis._afterQueue[this._afterQueueLen++] = task;\n\t\tthis.run();\n\t};\n\n\tScheduler.prototype.run = function() {\n\t\tif (!this._running) {\n\t\t\tthis._running = true;\n\t\t\tthis._async(this.drain);\n\t\t}\n\t};\n\n\t/**\n\t * Drain the handler queue entirely, and then the after queue\n\t */\n\tScheduler.prototype._drain = function() {\n\t\tvar i = 0;\n\t\tfor (; i < this._queueLen; ++i) {\n\t\t\tthis._queue[i].run();\n\t\t\tthis._queue[i] = void 0;\n\t\t}\n\n\t\tthis._queueLen = 0;\n\t\tthis._running = false;\n\n\t\tfor (i = 0; i < this._afterQueueLen; ++i) {\n\t\t\tthis._afterQueue[i].run();\n\t\t\tthis._afterQueue[i] = void 0;\n\t\t}\n\n\t\tthis._afterQueueLen = 0;\n\t};\n\n\treturn Scheduler;\n\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(); }));\n","/**\n * Basic configuration\n */\nmodule.exports = function () {\n\tthis.encoding\t= 'utf8';\n\tthis.timeout\t= 0;\n\tthis.maxBuffer\t= 200 * 1024\n}","var fs\t\t\t= require('fs')\n  , path\t\t= require('path')\n  , when\t\t= require('when');\n\nvar errors\t\t= require('./errors')\n  , presets\t\t= require('./presets')\n  , utils\t\t= require('./utils');\n\nmodule.exports = function (filePath, settings, infoConfiguration, infoFile) {\n\t\n\t// Public info about file and ffmpeg configuration\n\tthis.file_path\t\t\t\t= filePath;\n\tthis.info_configuration\t\t= infoConfiguration;\n\tthis.metadata\t\t\t\t= infoFile;\n\t\n\t// Commands for building the ffmpeg string conversion\n\tvar commands\t\t= new Array()\n\t  , inputs\t\t\t= new Array()\n\t  , filtersComlpex\t= new Array()\n\t  , output\t\t\t= null;\n\t\n\t// List of options generated from setting functions\n\tvar options\t\t\t= new Object();\n\t\n\t/*****************************************/\n\t/* FUNCTION FOR FILL THE COMMANDS OBJECT */\n\t/*****************************************/\n\t\n\t/**\n\t * Add a command to be bundled into the ffmpeg command call\n\t */\n\tthis.addCommand = function (command, argument) {\n\t\t// Check if exists the current command\n\t\tif (utils.in_array(command, commands) === false) {\n\t\t\t// Add the new command\n\t\t\tcommands.push(command);\n\t\t\t// Add the argument to new command\n\t\t\tif (argument != undefined)\n\t\t\t\tcommands.push(argument);\n\t\t} else \n\t\t\tthrow errors.renderError('command_already_exists', command);\n\t}\n\t\n\t/**\n\t * Add an input stream\n\t */\n\tthis.addInput = function (argument) {\n\t\tinputs.push(argument);\n\t}\n\t\n\t/**\n\t * Add a filter complex\n\t */\n\tthis.addFilterComplex = function (argument) {\n\t\tfiltersComlpex.push(argument);\n\t}\n\t\n\t/**\n\t * Set the output path\n\t */\n\tvar setOutput = function (path) {\n\t\toutput = path;\n\t}\n\t\n\t/*********************/\n\t/* SETTING FUNCTIONS */\n\t/*********************/\n\t\n\t/**\n\t * Disables audio encoding\n\t */\n\tthis.setDisableAudio = function () {\n\t\tif (options.audio == undefined)\n\t\t\toptions.audio = new Object();\n\t\t// Set the new option\n\t\toptions.audio.disabled = true;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Disables video encoding\n\t */\n\tthis.setDisableVideo = function () {\n\t\tif (options.video == undefined)\n\t\t\toptions.video = new Object();\n\t\t// Set the new option\n\t\toptions.video.disabled = true;\n\t\treturn this;\n\t}\n\t\n\t/**\n\t * Sets the new video format\n\t */\n\tthis.setVideoFormat = function (format) {\n\t\t// Check if the format is supported by ffmpeg version\n\t\tif (this.info_configuration.encode.indexOf(format) != -1) {\n\t\t\tif (options.video == undefined)\n\t\t\t\toptions.video = new Object();\n\t\t\t// Set the new option\n\t\t\toptions.video.format = format;\n\t\t\treturn this;\n\t\t} else \n\t\t\tthrow errors.renderError('format_not_supported', format);\n\t}\n\t\n\t/**\n\t * Sets the new audio codec\n\t */\n\tthis.setVideoCodec = function (codec) {\n\t\t// Check if the codec is supported by ffmpeg version\n\t\tif (this.info_configuration.encode.indexOf(codec) != -1) {\n\t\t\tif (options.video == undefined)\n\t\t\t\toptions.video = new Object();\n\t\t\t// Set the new option\n\t\t\toptions.video.codec = codec;\n\t\t\treturn this;\n\t\t} else \n\t\t\tthrow errors.renderError('codec_not_supported', codec);\n\t}\n\t\n\t/**\n\t * Sets the video bitrate\n\t */\n\tthis.setVideoBitRate = function (bitrate) {\n\t\tif (options.video == undefined)\n\t\t\toptions.video = new Object();\n\t\t// Set the new option\n\t\toptions.video.bitrate = bitrate;\n\t\treturn this;\n\t}\n\t\n\t/**\n\t * Sets the framerate of the video\n\t */\n\tthis.setVideoFrameRate = function (framerate) {\n\t\tif (options.video == undefined)\n\t\t\toptions.video = new Object();\n\t\t// Set the new option\n\t\toptions.video.framerate = framerate;\n\t\treturn this;\t\t\n\t}\n\t\n\t/**\n\t * Sets the start time\n\t */\n\tthis.setVideoStartTime = function (time) {\n\t\tif (options.video == undefined)\n\t\t\toptions.video = new Object();\n\t\t\n\t\t// Check if time is a string that contain: hours, minutes and seconds\n\t\tif (isNaN(time) && /([0-9]+):([0-9]{2}):([0-9]{2})/.exec(time)) {\n\t\t\ttime = utils.durationToSeconds(time);\t\t\t\n\t\t} else if (!isNaN(time) && parseInt(time) == time) {\n\t\t\ttime = parseInt(time, 10);\t\t\t\n\t\t} else {\n\t\t\ttime = 0;\t\t\t\n\t\t}\n\n\t\t// Set the new option\n\t\toptions.video.startTime = time;\n\t\treturn this;\n\t}\n\t\n\t/**\n\t * Sets the duration\n\t */\n\tthis.setVideoDuration = function (duration) {\n\t\tif (options.video == undefined)\n\t\t\toptions.video = new Object();\n\t\t\n\t\t// Check if duration is a string that contain: hours, minutes and seconds\n\t\tif (isNaN(duration) && /([0-9]+):([0-9]{2}):([0-9]{2})/.exec(duration)) {\n\t\t\tduration = utils.durationToSeconds(duration);\n\t\t} else if (!isNaN(duration) && parseInt(duration) == duration) {\n\t\t\tduration = parseInt(duration, 10);\t\t\t\n\t\t} else {\n\t\t\tduration = 0;\n\t\t}\n\n\t\t// Set the new option\n\t\toptions.video.duration = duration;\n\t\treturn this;\n\t}\n\t\n\t/**\n\t * Sets the new aspetc ratio\n\t */\n\tthis.setVideoAspectRatio = function (aspect) {\n\t\t// Check if aspect is a string\n\t\tif (isNaN(aspect)) {\n\t\t\t// Check if aspet is string xx:xx\n\t\t\tif (/([0-9]+):([0-9]+)/.exec(aspect)) {\n\t\t\t\tvar check = /([0-9]+):([0-9]+)/.exec(aspect);\n\t\t\t\taspect = parseFloat((check[1] / check[2]));\n\t\t\t} else {\n\t\t\t\taspect = this.metadata.video.aspect.value;\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (options.video == undefined)\n\t\t\toptions.video = new Object();\n\t\t// Set the new option\n\t\toptions.video.aspect = aspect;\n\t\treturn this;\n\t}\n\t\n\t/**\n\t * Set the size of the video\n\t */\n\tthis.setVideoSize = function (size, keepPixelAspectRatio, keepAspectRatio, paddingColor) {\n\t\tif (options.video == undefined)\n\t\t\toptions.video = new Object();\n\t\t// Set the new option\n\t\toptions.video.size = size;\n\t\toptions.video.keepPixelAspectRatio = keepPixelAspectRatio;\n\t\toptions.video.keepAspectRatio = keepAspectRatio;\n\t\toptions.video.paddingColor = paddingColor;\n\t\treturn this;\n\t}\n\t\n\t/**\n\t * Sets the new audio codec\n\t */\n\tthis.setAudioCodec = function (codec) {\n\t\t// Check if the codec is supported by ffmpeg version\n\t\tif (this.info_configuration.encode.indexOf(codec) != -1) {\n\t\t\t// Check if codec is equal 'MP3' and check if the version of ffmpeg support the libmp3lame function\n\t\t\tif (codec == 'mp3' && this.info_configuration.modules.indexOf('libmp3lame') != -1)\n\t\t\t\tcodec = 'libmp3lame';\n\t\t\t\n\t\t\tif (options.audio == undefined)\n\t\t\t\toptions.audio = new Object();\n\t\t\t// Set the new option\n\t\t\toptions.audio.codec = codec;\n\t\t\treturn this;\n\t\t} else \n\t\t\tthrow errors.renderError('codec_not_supported', codec);\n\t}\n\t\n\t/**\n\t * Sets the audio sample frequency for audio outputs\n\t */\n\tthis.setAudioFrequency = function (frequency) {\n\t\tif (options.audio == undefined)\n\t\t\toptions.audio = new Object();\n\t\t// Set the new option\n\t\toptions.audio.frequency = frequency;\n\t\treturn this;\n\t}\n\t\n\t/**\n\t * Sets the number of audio channels\n\t */\n\tthis.setAudioChannels = function (channel) {\n\t\t// Check if the channel value is valid\n\t\tif (presets.audio_channel.stereo == channel || presets.audio_channel.mono == channel) {\n\t\t\tif (options.audio == undefined)\n\t\t\t\toptions.audio = new Object();\n\t\t\t// Set the new option\n\t\t\toptions.audio.channel = channel;\n\t\t\treturn this;\t\t\t\n\t\t} else \n\t\t\tthrow errors.renderError('audio_channel_is_invalid', channel);\n\t}\n\t\n\t/**\n\t * Sets the audio bitrate\n\t */\n\tthis.setAudioBitRate = function (bitrate) {\n\t\tif (options.audio == undefined)\n\t\t\toptions.audio = new Object();\n\t\t// Set the new option\n\t\toptions.audio.bitrate = bitrate;\n\t\treturn this;\n\t}\n\t\n\t/**\n\t * Sets the audio quality\n\t */\n\tthis.setAudioQuality = function (quality) {\n\t\tif (options.audio == undefined)\n\t\t\toptions.audio = new Object();\n\t\t// Set the new option\n\t\toptions.audio.quality = quality;\n\t\treturn this;\n\t}\n\t\n\t/**\n\t * Sets the watermark\n\t */\n\tthis.setWatermark = function (watermarkPath, settings) {\n\t\t// Base settings\n\t\tvar baseSettings = {\n\t\t\tposition\t\t: \"SW\"\t\t// Position: NE NC NW SE SC SW C CE CW\n\t\t  , margin_nord\t\t: null\t\t// Margin nord\n\t\t  , margin_sud\t\t: null\t\t// Margin sud\n\t\t  , margin_east\t\t: null\t\t// Margin east\n\t\t  , margin_west\t\t: null\t\t// Margin west\n\t\t};\n\t\t\n\t\t// Check if watermark exists\n\t\tif (!fs.existsSync(watermarkPath))\n\t\t\tthrow errors.renderError('invalid_watermark', watermarkPath);\n\t\t\n\t\t// Check if the settings are specified\n\t\tif (settings != null)\n\t\t\tutils.mergeObject(baseSettings, settings);\n\t\t\n\t\t// Check if position is valid\n\t\tif (baseSettings.position == null || utils.in_array(baseSettings.position, ['NE','NC','NW','SE','SC','SW','C','CE','CW']) === false)\n\t\t\tthrow errors.renderError('invalid_watermark_position', baseSettings.position);\n\t\t\n\t\t// Check if margins are valid\n\t\t\n\t\tif (baseSettings.margin_nord == null || isNaN(baseSettings.margin_nord))\n\t\t\tbaseSettings.margin_nord = 0;\n\t\tif (baseSettings.margin_sud == null || isNaN(baseSettings.margin_sud))\n\t\t\tbaseSettings.margin_sud = 0;\n\t\tif (baseSettings.margin_east == null || isNaN(baseSettings.margin_east))\n\t\t\tbaseSettings.margin_east = 0;\n\t\tif (baseSettings.margin_west == null || isNaN(baseSettings.margin_west))\n\t\t\tbaseSettings.margin_west = 0;\n\t\t\n\t\tvar overlay = '';\n\t\t\n\t\tvar getSing = function (val, inverse) {\n\t\t\treturn (val > 0 ? (inverse ? '-' : '+') : (inverse ? '+' : '-')).toString() + Math.abs(val).toString();\n\t\t}\n\t\t\n\t\tvar getHorizontalMargins = function (east, west) {\n\t\t\treturn getSing(east, false).toString() + getSing(west, true).toString();\n\t\t}\n\t\t\n\t\tvar getVerticalMargins = function (nord, sud) {\n\t\t\treturn getSing(nord, false).toString() + getSing(sud, true).toString();\n\t\t}\n\t\t\n\t\t// Calculate formula\t\t\n\t\tswitch (baseSettings.position) {\n\t\t\tcase 'NE':\n\t\t\t\toverlay = '0' + getHorizontalMargins(baseSettings.margin_east, baseSettings.margin_west) + ':0' + getVerticalMargins(baseSettings.margin_nord, baseSettings.margin_sud);\n\t\t\t\tbreak;\n\t\t\tcase 'NC':\n\t\t\t\toverlay = 'main_w/2-overlay_w/2' + getHorizontalMargins(baseSettings.margin_east, baseSettings.margin_west) + ':0' + getVerticalMargins(baseSettings.margin_nord, baseSettings.margin_sud);\n\t\t\t\tbreak;\n\t\t\tcase 'NW':\n\t\t\t\toverlay = 'main_w-overlay_w' + getHorizontalMargins(baseSettings.margin_east, baseSettings.margin_west) + ':0' + getVerticalMargins(baseSettings.margin_nord, baseSettings.margin_sud);\n\t\t\t\tbreak;\n\t\t\tcase 'SE':\n\t\t\t\toverlay = '0' + getHorizontalMargins(baseSettings.margin_east, baseSettings.margin_west) + ':main_h-overlay_h' + getVerticalMargins(baseSettings.margin_nord, baseSettings.margin_sud);\n\t\t\t\tbreak;\n\t\t\tcase 'SC':\n\t\t\t\toverlay = 'main_w/2-overlay_w/2' + getHorizontalMargins(baseSettings.margin_east, baseSettings.margin_west) + ':main_h-overlay_h' + getVerticalMargins(baseSettings.margin_nord, baseSettings.margin_sud);\n\t\t\t\tbreak;\n\t\t\tcase 'SW':\n\t\t\t\toverlay = 'main_w-overlay_w' + getHorizontalMargins(baseSettings.margin_east, baseSettings.margin_west) + ':main_h-overlay_h' + getVerticalMargins(baseSettings.margin_nord, baseSettings.margin_sud);\n\t\t\t\tbreak;\n\t\t\tcase 'CE':\n\t\t\t\toverlay = '0' + getHorizontalMargins(baseSettings.margin_east, baseSettings.margin_west) + ':main_h/2-overlay_h/2' + getVerticalMargins(baseSettings.margin_nord, baseSettings.margin_sud);\n\t\t\t\tbreak;\n\t\t\tcase 'C':\n\t\t\t\toverlay = 'main_w/2-overlay_w/2' + getHorizontalMargins(baseSettings.margin_east, baseSettings.margin_west) + ':main_h/2-overlay_h/2' + getVerticalMargins(baseSettings.margin_nord, baseSettings.margin_sud);\n\t\t\t\tbreak;\n\t\t\tcase 'CW':\n\t\t\t\toverlay = 'main_w-overlay_w' + getHorizontalMargins(baseSettings.margin_east, baseSettings.margin_west) + ':main_h/2-overlay_h/2' + getVerticalMargins(baseSettings.margin_nord, baseSettings.margin_sud);\n\t\t\t\tbreak;\n\t\t}\n\t\t\n\t\t// Check if the call comes from internal function\n\t\tif (arguments[2] == undefined || arguments[2] == null) {\n\t\t\tif (options.video == undefined)\n\t\t\t\toptions.video = new Object();\n\t\t\t// Set the new option\n\t\t\toptions.video.watermark = { path : watermarkPath, overlay : overlay };\n\t\t\treturn this;\n\t\t} else if (arguments[2] != undefined && arguments[2] === true) {\n\t\t\tthis.addInput(watermarkPath);\n\t\t\tthis.addFilterComplex('overlay=' + overlay);\n\t\t}\n\t}\n\t\n\t/**\n\t * Save all set commands\n\t */\n\tthis.save = function (destionationFileName, callback) {\n\t\t// Check if the 'video' is present in the options\n\t\tif (options.hasOwnProperty('video')) {\n\t\t\t// Check if video is disabled\n\t\t\tif (options.video.hasOwnProperty('disabled')) {\n\t\t\t\tthis.addCommand('-vn');\t\t\t\t\n\t\t\t} else {\n\t\t\t\t// Check all video property\n\t\t\t\tif (options.video.hasOwnProperty('format'))\n\t\t\t\t\tthis.addCommand('-f', options.video.format);\n\t\t\t\tif (options.video.hasOwnProperty('codec'))\n\t\t\t\t\tthis.addCommand('-vcodec', options.video.codec);\n\t\t\t\tif (options.video.hasOwnProperty('bitrate'))\n\t\t\t\t\tthis.addCommand('-b', parseInt(options.video.bitrate, 10) + 'kb');\n\t\t\t\tif (options.video.hasOwnProperty('framerate'))\n\t\t\t\t\tthis.addCommand('-r', parseInt(options.video.framerate, 10));\n\t\t\t\tif (options.video.hasOwnProperty('startTime'))\n\t\t\t\t\tthis.addCommand('-ss', parseInt(options.video.startTime, 10));\n\t\t\t\tif (options.video.hasOwnProperty('duration'))\n\t\t\t\t\tthis.addCommand('-t', parseInt(options.video.duration, 10));\n\t\t\t\t\n\t\t\t\tif (options.video.hasOwnProperty('watermark')) {\n\t\t\t\t\tthis.addInput(options.video.watermark.path);\n\t\t\t\t\tthis.addFilterComplex('overlay=' + options.video.watermark.overlay);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Check if the video should be scaled\n\t\t\t\tif (options.video.hasOwnProperty('size')) {\n\t\t\t\t\tvar newDimension = _calculateNewDimension.call(this);\n\t\t\t\t\t\n\t\t\t\t\tif (newDimension.aspect != null) {\n\t\t\t\t\t\tthis.addFilterComplex('scale=iw*sar:ih, pad=max(iw\\\\,ih*(' + newDimension.aspect.x + '/' + newDimension.aspect.y + ')):ow/(' + newDimension.aspect.x + '/' + newDimension.aspect.y + '):(ow-iw)/2:(oh-ih)/2' + (options.video.paddingColor != null ? ':' + options.video.paddingColor : ''));\n\t\t\t\t\t\tthis.addCommand('-aspect', newDimension.aspect.string);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tthis.addCommand('-s', newDimension.width + 'x' + newDimension.height);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// Check if the 'audio' is present in the options\n\t\tif (options.hasOwnProperty('audio')) {\n\t\t\t// Check if audio is disabled\n\t\t\tif (options.audio.hasOwnProperty('disabled')) {\n\t\t\t\tthis.addCommand('-an');\t\t\t\t\n\t\t\t} else {\n\t\t\t\t// Check all audio property\n\t\t\t\tif (options.audio.hasOwnProperty('codec'))\n\t\t\t\t\tthis.addCommand('-acodec', options.audio.codec);\n\t\t\t\tif (options.audio.hasOwnProperty('frequency'))\n\t\t\t\t\tthis.addCommand('-ar', parseInt(options.audio.frequency));\n\t\t\t\tif (options.audio.hasOwnProperty('channel'))\n\t\t\t\t\tthis.addCommand('-ac', options.audio.channel);\n\t\t\t\tif (options.audio.hasOwnProperty('quality'))\n\t\t\t\t\tthis.addCommand('-aq', options.audio.quality);\n\t\t\t\tif (options.audio.hasOwnProperty('bitrate'))\n\t\t\t\t\tthis.addCommand('-ab', parseInt(options.audio.bitrate, 10) + 'k');\n\t\t\t}\n\t\t}\n\t\t\n\t\tsetOutput(destionationFileName);\n\t\t\n\t\treturn execCommand.call(this, callback);\n\t}\n\t\n\t/*********************/\n\t/* INTERNAL FUNCTION */\n\t/*********************/\n\t\n\t/**\n\t * Reset the list of commands\n\t */\n\tvar resetCommands = function (self) {\n\t\tcommands\t\t= new Array()\n\t\tinputs\t\t\t= [self.file_path];\n\t\tfiltersComlpex\t= new Array();\n\t\toutput\t\t\t= null;\n\t\toptions\t\t\t= new Object();\n\t}\n\n\t/**\n\t * Calculate width, height and aspect ratio by the new dimension data\n\t */\n\tvar _calculateNewDimension = function () {\n\t\t// Check if keepPixelAspectRatio is undefined\n\t\tvar keepPixelAspectRatio = typeof options.video.keepPixelAspectRatio != 'boolean' ? false : options.video.keepPixelAspectRatio;\n\t\t// Check if keepAspectRatio is undefined\n\t\tvar keepAspectRatio = typeof options.video.keepAspectRatio != 'boolean' ? false : options.video.keepAspectRatio;\n\t\t\n\t\t// Resolution to be taken as a reference\n\t\tvar referrerResolution = this.metadata.video.resolution;\n\t\t// Check if is need keep pixel aspect ratio\n\t\tif (keepPixelAspectRatio) {\n\t\t\t// Check if exists resolution for pixel aspect ratio\n\t\t\tif (utils.isEmptyObj(this.metadata.video.resolutionSquare))\n\t\t\t\tthrow errors.renderError('resolution_square_not_defined');\n\t\t\t\n\t\t\t// Apply the resolutionSquare\n\t\t\treferrerResolution = this.metadata.video.resolutionSquare;\n\t\t}\n\t\t\n\t\t// Final data\n\t\tvar width\t= null\n\t\t  , height\t= null\n\t\t  , aspect\t= null;\n\n\t\t// Regex to check which type of dimension was specified\n\t\tvar fixedWidth\t\t= /([0-9]+)x\\?/.exec(options.video.size)\n\t\t  , fixedHeight\t\t= /\\?x([0-9]+)/.exec(options.video.size)\n\t\t  , percentage\t\t= /([0-9]{1,2})%/.exec(options.video.size)\n\t\t  , classicSize\t\t= /([0-9]+)x([0-9]+)/.exec(options.video.size);\n\t\t  \n\t\tif (fixedWidth) {\n\t\t\t// Set the width dimension\n\t\t\twidth = parseInt(fixedWidth[1], 10);\t\t\t\n\t\t\t// Check if the video has the aspect ratio setted\n\t\t\tif (!utils.isEmptyObj(this.metadata.video.aspect)) {\n\t\t\t\theight = Math.round((width / this.metadata.video.aspect.x) * this.metadata.video.aspect.y);\n\t\t\t} else {\n\t\t\t\t// Calculte the new height\n\t\t\t\theight = Math.round(referrerResolution.h / (referrerResolution.w / parseInt(fixedWidth[1], 10)));\n\t\t\t}\n\t\t} else if (fixedHeight) {\n\t\t\t// Set the width dimension\n\t\t\theight = parseInt(fixedHeight[1], 10);\t\t\t\n\t\t\t// Check if the video has the aspect ratio setted\n\t\t\tif (!utils.isEmptyObj(this.metadata.video.aspect)) {\n\t\t\t\twidth = Math.round((height / this.metadata.video.aspect.y) * this.metadata.video.aspect.x);\n\t\t\t} else {\n\t\t\t\t// Calculte the new width\n\t\t\t\twidth = Math.round(referrerResolution.w / (referrerResolution.h / parseInt(fixedHeight[1], 10)));\n\t\t\t}\t\t\t\n\t\t} else if (percentage) {\n\t\t\t// Calculte the ratio from percentage\n\t\t\tvar ratio = parseInt(percentage[1], 10) / 100;\n\t\t\t// Calculate the new dimensions\n\t\t\twidth = Math.round(referrerResolution.w * ratio);\n\t\t\theight = Math.round(referrerResolution.h * ratio);\n\t\t} else if (classicSize) {\n\t\t\twidth = parseInt(classicSize[1], 10);\n\t\t\theight = parseInt(classicSize[2], 10);\n\t\t} else \n\t\t\tthrow errors.renderError('size_format', options.video.size);\n\t\t\n\t\t// If the width or height are not multiples of 2 will be decremented by one unit\n\t\tif (width % 2 != 0) width -= 1;\n\t\tif (height % 2 != 0) height -= 1;\n\t\t\n\t\tif (keepAspectRatio) {\n\t\t\t// Calculate the new aspect ratio\n\t\t\tvar gcdValue\t= utils.gcd(width, height);\n\t\t\t\n\t\t\taspect = new Object();\n\t\t\taspect.x = width / gcdValue;\n\t\t\taspect.y = height / gcdValue;\n\t\t\taspect.string = aspect.x + ':' + aspect.y;\n\t\t}\n\t\t\n\t\treturn { width : width, height : height, aspect : aspect };\n\t}\n\t\n\t/**\n\t * Executing the commands list\n\t */\n\tvar execCommand = function (callback, folder) {\n\t\t// Checking if folder is defined\n\t\tvar onlyDestinationFile = folder != undefined ? false : true;\n\t\t// Building the value for return value. Check if the callback is not a function. In this case will created a new instance of the deferred class\n\t\tvar deferred = typeof callback != 'function' ? when.defer() : { promise : null };\n\t\t// Create a copy of the commands list\n\t\tvar finalCommands = ['ffmpeg -i']\n\t\t\t.concat(inputs.join(' -i '))\n\t\t\t.concat(commands.join(' '))\n\t\t\t.concat(filtersComlpex.length > 0 ? ['-filter_complex \"'].concat(filtersComlpex.join(', ')).join('') + '\"' : [])\n\t\t\t.concat([output]);\n\t\t// Reset commands\n\t\tresetCommands(this);\n\t\t// Execute the commands from the list\n\t\tutils.exec(finalCommands, settings, function (error, stdout, stderr) {\n\t\t\t// Building the result\n\t\t\tvar result = null;\n\t\t\tif (!error) {\n\t\t\t\t// Check if show only destination filename or the complete file list\n\t\t\t\tif (onlyDestinationFile) {\n\t\t\t\t\tresult = finalCommands[finalCommands.length-1];\n\t\t\t\t} else {\n\t\t\t\t\t// Clean possible \"/\" at the end of the string\n\t\t\t\t\tif (folder.charAt(folder.length-1) == \"/\")\n\t\t\t\t\t\tfolder = folder.substr(0, folder.length-1);\n\t\t\t\t\t// Read file list inside the folder\n\t\t\t\t\tresult = fs.readdirSync(folder);\n\t\t\t\t\t// Scan all file and prepend the folder path\n\t\t\t\t\tfor (var i in result)\n\t\t\t\t\t\tresult[i] = [folder, result[i]].join('/')\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Check if the callback is a function\n\t\t\tif (typeof callback == 'function') {\n\t\t\t\t// Call the callback to return the info\n\t\t\t\tcallback(error, result);\n\t\t\t} else {\n\t\t\t\tif (error) {\n\t\t\t\t\t// Negative response\n\t\t\t\t\tdeferred.reject(error);\n\t\t\t\t} else {\n\t\t\t\t\t// Positive response\n\t\t\t\t\tdeferred.resolve(result);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t// Return a possible promise instance\n\t\treturn deferred.promise;\n\t}\n\t\n\t/*******************/\n\t/* PRESET FUNCTION */\n\t/*******************/\n\t\n\t/**\n\t * Extracting sound from a video, and save it as Mp3\n\t */\n\tthis.fnExtractSoundToMP3 = function (destionationFileName, callback) {\n\t\t// Check if file already exists. In this case will remove it\n\t\tif (fs.existsSync(destionationFileName)) \n\t\t\tfs.unlinkSync(destionationFileName);\n\n\t\t// Building the final path\n\t\tvar destinationDirName\t\t= path.dirname(destionationFileName)\n\t\t  , destinationFileNameWE\t= path.basename(destionationFileName, path.extname(destionationFileName)) + '.mp3'\n\t\t  , finalPath\t\t\t\t= path.join(destinationDirName, destinationFileNameWE);\n\t\t\n\t\tresetCommands(this);\n\t\t\n\t\t// Adding commands to the list\n\t\tthis.addCommand('-vn');\n\t\tthis.addCommand('-ar', 44100);\n\t\tthis.addCommand('-ac', 2);\n\t\tthis.addCommand('-ab', 192);\n\t\tthis.addCommand('-f', 'mp3');\n\t\t\n\t\t// Add destination file path to the command list\n\t\tsetOutput(finalPath);\n\t\t\n\t\t// Executing the commands list\n\t\treturn execCommand.call(this, callback);\n\t}\n\t\n\t/**\n\t * Extract frame from video file\n\t */\n\tthis.fnExtractFrameToJPG = function (/* destinationFolder, settings, callback */) {\n\t\t\n\t\tvar destinationFolder\t= null\n\t\t  , newSettings\t\t\t= null\n\t\t  , callback\t\t\t= null;\n\t\t  \n\t\tvar settings = {\n\t\t\tstart_time\t\t\t\t: null\t\t// Start time to recording\n\t\t  , duration_time\t\t\t: null\t\t// Duration of recording\n\t\t  , frame_rate\t\t\t\t: null\t\t// Number of the frames to capture in one second\n\t\t  , size\t\t\t\t\t: null\t\t// Dimension each frame\n\t\t  , number\t\t\t\t\t: null\t\t// Total frame to capture\n\t\t  , every_n_frames\t\t\t: null\t\t// Frame to capture every N frames\n\t\t  , every_n_seconds\t\t\t: null\t\t// Frame to capture every N seconds\n\t\t  , every_n_percentage\t\t: null\t\t// Frame to capture every N percentage range\n\t\t  , keep_pixel_aspect_ratio\t: true\t\t// Mantain the original pixel video aspect ratio\n\t\t  , keep_aspect_ratio\t\t: true\t\t// Mantain the original aspect ratio\n\t\t  , padding_color\t\t\t: 'black'\t// Padding color\n\t\t  , file_name\t\t\t\t: null\t\t// File name\n\t\t};\n\t\t  \n\t\t// Scan all arguments\n\t\tfor (var i in arguments) {\n\t\t\t// Check the type of the argument\n\t\t\tswitch (typeof arguments[i]) {\n\t\t\t\tcase 'string':\n\t\t\t\t\tdestinationFolder = arguments[i];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'object':\n\t\t\t\t\tnewSettings = arguments[i];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'function':\n\t\t\t\t\tcallback = arguments[i];\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Check if the settings are specified\n\t\tif (newSettings !== null)\n\t\t\tutils.mergeObject(settings, newSettings);\n\n\t\t// Check if 'start_time' is in the format hours:minutes:seconds\n\t\tif (settings.start_time != null) {\n\t\t\tif (/([0-9]+):([0-9]{2}):([0-9]{2})/.exec(settings.start_time))\n\t\t\t\tsettings.start_time = utils.durationToSeconds(settings.start_time);\n\t\t\telse if (!isNaN(settings.start_time))\n\t\t\t\tsettings.start_time = parseInt(settings.start_time, 10);\n\t\t\telse\n\t\t\t\tsettings.start_time = null;\n\t\t}\n\n\t\t// Check if 'duration_time' is in the format hours:minutes:seconds\n\t\tif (settings.duration_time != null) {\n\t\t\tif (/([0-9]+):([0-9]{2}):([0-9]{2})/.exec(settings.duration_time))\n\t\t\t\tsettings.duration_time = utils.durationToSeconds(settings.duration_time);\n\t\t\telse if (!isNaN(settings.duration_time))\n\t\t\t\tsettings.duration_time = parseInt(settings.duration_time, 10);\n\t\t\telse\n\t\t\t\tsettings.duration_time = null;\n\t\t}\n\n\t\t// Check if the value of the framerate is number type\n\t\tif (settings.frame_rate != null && isNaN(settings.frame_rate))\n\t\t\tsettings.frame_rate = null;\n\n\t\t// If the size is not settings then the size of the screenshots is equal to video size\n\t\tif (settings.size == null)\n\t\t\tsettings.size = this.metadata.video.resolution.w + 'x' + this.metadata.video.resolution.h;\n\n\t\t// Check if the value of the 'number frame to capture' is number type\n\t\tif (settings.number != null && isNaN(settings.number))\n\t\t\tsettings.number = null;\n\n\t\tvar every_n_check = 0;\n\n\t\t// Check if the value of the 'every_n_frames' is number type\n\t\tif (settings.every_n_frames != null && isNaN(settings.every_n_frames)) {\n\t\t\tsettings.every_n_frames = null;\n\t\t\tevery_n_check++;\n\t\t}\n\n\t\t// Check if the value of the 'every_n_seconds' is number type\n\t\tif (settings.every_n_seconds != null && isNaN(settings.every_n_seconds)) {\n\t\t\tsettings.every_n_seconds = null;\n\t\t\tevery_n_check++;\n\t\t}\n\n\t\t// Check if the value of the 'every_n_percentage' is number type\n\t\tif (settings.every_n_percentage != null && (isNaN(settings.every_n_percentage) || settings.every_n_percentage > 100)) {\n\t\t\tsettings.every_n_percentage = null;\n\t\t\tevery_n_check++;\n\t\t}\n\t\t\n\t\tif (every_n_check >= 2) {\n\t\t\tif (callback) {\n\t\t\t\tcallback(errors.renderError('extract_frame_invalid_everyN_options'));\n\t\t\t} else {\n\t\t\t\tthrow errors.renderError('extract_frame_invalid_everyN_options');\n\t\t\t}\n\t\t}\t\t\t\n\t\t\n\t\t// If filename is null then his value is equal to original filename\n\t\tif (settings.file_name == null) {\n\t\t\tsettings.file_name = path.basename(this.file_path, path.extname(this.file_path));\n\t\t} else {\n\t\t\t// Retrieve all possible replacements\n\t\t\tvar replacements = settings.file_name.match(/(\\%[a-zA-Z]{1})/g);\n\t\t\t// Check if exists replacements. The scan all replacements and build the final filename\n\t\t\tif (replacements) {\n\t\t\t\tfor (var i in replacements) {\n\t\t\t\t\tswitch (replacements[i]) {\n\t\t\t\t\t\tcase '%t':\n\t\t\t\t\t\t\tsettings.file_name = settings.file_name.replace('%t', new Date().getTime());\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase '%s':\n\t\t\t\t\t\t\tsettings.file_name = settings.file_name.replace('%s', settings.size);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase '%x':\n\t\t\t\t\t\t\tsettings.file_name = settings.file_name.replace('%x', settings.size.split(':')[0]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase '%y':\n\t\t\t\t\t\t\tsettings.file_name = settings.file_name.replace('%y', settings.size.split(':')[1]);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tsettings.file_name = settings.file_name.replace(replacements[i], '');\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// At the filename will added the number of the frame\n\t\tsettings.file_name = path.basename(settings.file_name, path.extname(settings.file_name)) + '_%d.jpg';\n\t\t\n\t\t// Create the directory to save the extracted frames\n\t\tutils.mkdir(destinationFolder, 0777);\n\t\t\n\t\tresetCommands(this);\n\t\t\n\t\t// Adding commands to the list\n\t\tif (settings.startTime)\n\t\t\tthis.addCommand('-ss', settings.startTime);\n\t\tif (settings.duration_time)\n\t\t\tthis.addCommand('-t', settings.duration_time);\n\t\tif (settings.frame_rate)\n\t\t\tthis.addCommand('-r', settings.frame_rate);\n\n\t\t// Setting the size and padding settings\n\t\tthis.setVideoSize(settings.size, settings.keep_pixel_aspect_ratio, settings.keep_aspect_ratio, settings.padding_color);\n\t\t// Get the dimensions\n\t\tvar newDimension = _calculateNewDimension.call(this);\n\t\t// Apply the size and padding commands\n\t\tthis.addCommand('-s', newDimension.width + 'x' + newDimension.height);\n\t\t// CHeck if isset aspect ratio options\n\t\tif (newDimension.aspect != null) {\n\t\t\tthis.addFilterComplex('scale=iw*sar:ih, pad=max(iw\\\\,ih*(' + newDimension.aspect.x + '/' + newDimension.aspect.y + ')):ow/(' + newDimension.aspect.x + '/' + newDimension.aspect.y + '):(ow-iw)/2:(oh-ih)/2' + (settings.padding_color != null ? ':' + settings.padding_color : ''));\n\t\t\tthis.addCommand('-aspect', newDimension.aspect.string);\n\t\t}\n\n\t\tif (settings.number)\n\t\t\tthis.addCommand('-vframes', settings.number);\n\t\tif (settings.every_n_frames) {\n\t\t\tthis.addCommand('-vsync', 0);\t\t\t\t\t\n\t\t\tthis.addFilterComplex('select=not(mod(n\\\\,' + settings.every_n_frames + '))');\n\t\t}\n\t\tif (settings.every_n_seconds) {\n\t\t\tthis.addCommand('-vsync', 0);\n\t\t\tthis.addFilterComplex('select=not(mod(t\\\\,' + settings.every_n_seconds + '))');\n\t\t}\n\t\tif (settings.every_n_percentage) {\n\t\t\tthis.addCommand('-vsync', 0);\n\t\t\tthis.addFilterComplex('select=not(mod(t\\\\,' + parseInt((this.metadata.duration.seconds / 100) * settings.every_n_percentage) + '))');\n\t\t}\n\t\t\n\t\t// Add destination file path to the command list\n\t\tsetOutput([destinationFolder,settings.file_name].join('/'));\n\n\t\t// Executing the commands list\n\t\treturn execCommand.call(this, callback, destinationFolder);\n\t}\n\n\t/**\n\t * Add a watermark to the video and save it\n\t */\n\tthis.fnAddWatermark = function (watermarkPath /* newFilepath , settings, callback */) {\n\n\t\tvar newFilepath\t\t= null\n\t\t  , newSettings\t\t= null\n\t\t  , callback\t\t= null;\n\t\t  \n\t\t// Scan all arguments\n\t\tfor (var i = 1; i < arguments.length; i++) {\n\t\t\t// Check the type of the argument\n\t\t\tswitch (typeof arguments[i]) {\n\t\t\t\tcase 'string':\n\t\t\t\t\tnewFilepath = arguments[i];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'object':\n\t\t\t\t\tnewSettings = arguments[i];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'function':\n\t\t\t\t\tcallback = arguments[i];\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t\n\t\tresetCommands(this);\n\n\t\t// Call the function to add the watermark options\n\t\tthis.setWatermark(watermarkPath, newSettings, true);\n\t\t\n\t\tif (newFilepath == null)\n\t\t\tnewFilepath = path.dirname(this.file_path) + '/' + \n\t\t\t\t\t\t  path.basename(this.file_path, path.extname(this.file_path)) + '_watermark_' + \n\t\t\t\t\t\t  path.basename(watermarkPath, path.extname(watermarkPath)) + \n\t\t\t\t\t\t  path.extname(this.file_path);\n\t\t\n\t\t// Add destination file path to the command list\n\t\tsetOutput(newFilepath);\n\n\t\t// Executing the commands list\n\t\treturn execCommand.call(this, callback);\n\t}\n\t\n\t/**\n\t * Constructor\n\t */\n\tvar __constructor = function (self) {\n\t\tresetCommands(self);\n\t}(this);\n}","module.exports.size = {\n\t'SQCIF'\t\t: '128x96'\n  ,\t'QCIF'\t\t: '176x144'\n  ,\t'CIF'\t\t: '352x288'\n  ,\t'4CIF'\t\t: '704x576'\n  ,\t'QQVGA'\t\t: '160x120'\n  ,\t'QVGA'\t\t: '320x240'\n  ,\t'VGA'\t\t: '640x480'\n  ,\t'SVGA'\t\t: '800x600'\n  ,\t'XGA'\t\t: '1024x768'\n  ,\t'UXGA'\t\t: '1600x1200'\n  ,\t'QXGA'\t\t: '2048x1536'\n  ,\t'SXGA'\t\t: '1280x1024'\n  ,\t'QSXGA'\t\t: '2560x2048'\n  ,\t'HSXGA'\t\t: '5120x4096'\n  ,\t'WVGA'\t\t: '852x480'\n  ,\t'WXGA'\t\t: '1366x768'\n  ,\t'WSXGA'\t\t: '1600x1024'\n  ,\t'WUXGA'\t\t: '1920x1200'\n  ,\t'WOXGA'\t\t: '2560x1600'\n  ,\t'WQSXGA'\t: '3200x2048'\n  ,\t'WQUXGA'\t: '3840x2400'\n  ,\t'WHSXGA'\t: '6400x4096'\n  ,\t'WHUXGA'\t: '7680x4800'\n  ,\t'CGA'\t\t: '320x200'\n  ,\t'EGA'\t\t: '640x350'\n  ,\t'HD480'\t\t: '852x480'\n  ,\t'HD720'\t\t: '1280x720'\n  ,\t'HD1080'\t: '1920x1080'\n}\n\nmodule.exports.ratio = {\n\t'4:3'\t\t: 1.33\n  , '3:2'\t\t: 1.5\n  , '14:9'\t\t: 1.56\n  , '16:9'\t\t: 1.78\n  , '21:9'\t\t: 2.33\n}\n\nmodule.exports.audio_channel = {\n\t'mono'\t\t: 1\n  ,\t'stereo'\t: 2\n}","module.exports = function() {\n\tthrow new Error(\"define cannot be used indirect\");\n};\n","/** @license MIT License (c) copyright 2010-2014 original author or authors */\n/** @author Brian Cavalier */\n/** @author John Hann */\n\n/*global process,document,setTimeout,clearTimeout,MutationObserver,WebKitMutationObserver*/\n(function(define) { 'use strict';\ndefine(function(require) {\n\t/*jshint maxcomplexity:6*/\n\n\t// Sniff \"best\" async scheduling option\n\t// Prefer process.nextTick or MutationObserver, then check for\n\t// setTimeout, and finally vertx, since its the only env that doesn't\n\t// have setTimeout\n\n\tvar MutationObs;\n\tvar capturedSetTimeout = typeof setTimeout !== 'undefined' && setTimeout;\n\n\t// Default env\n\tvar setTimer = function(f, ms) { return setTimeout(f, ms); };\n\tvar clearTimer = function(t) { return clearTimeout(t); };\n\tvar asap = function (f) { return capturedSetTimeout(f, 0); };\n\n\t// Detect specific env\n\tif (isNode()) { // Node\n\t\tasap = function (f) { return process.nextTick(f); };\n\n\t} else if (MutationObs = hasMutationObserver()) { // Modern browser\n\t\tasap = initMutationObserver(MutationObs);\n\n\t} else if (!capturedSetTimeout) { // vert.x\n\t\tvar vertxRequire = require;\n\t\tvar vertx = vertxRequire('vertx');\n\t\tsetTimer = function (f, ms) { return vertx.setTimer(ms, f); };\n\t\tclearTimer = vertx.cancelTimer;\n\t\tasap = vertx.runOnLoop || vertx.runOnContext;\n\t}\n\n\treturn {\n\t\tsetTimer: setTimer,\n\t\tclearTimer: clearTimer,\n\t\tasap: asap\n\t};\n\n\tfunction isNode () {\n\t\treturn typeof process !== 'undefined' &&\n\t\t\tObject.prototype.toString.call(process) === '[object process]';\n\t}\n\n\tfunction hasMutationObserver () {\n\t    return (typeof MutationObserver !== 'undefined' && MutationObserver) ||\n\t\t\t(typeof WebKitMutationObserver !== 'undefined' && WebKitMutationObserver);\n\t}\n\n\tfunction initMutationObserver(MutationObserver) {\n\t\tvar scheduled;\n\t\tvar node = document.createTextNode('');\n\t\tvar o = new MutationObserver(run);\n\t\to.observe(node, { characterData: true });\n\n\t\tfunction run() {\n\t\t\tvar f = scheduled;\n\t\t\tscheduled = void 0;\n\t\t\tf();\n\t\t}\n\n\t\tvar i = 0;\n\t\treturn function (f) {\n\t\t\tscheduled = f;\n\t\t\tnode.data = (i ^= 1);\n\t\t};\n\t}\n});\n}(typeof define === 'function' && define.amd ? define : function(factory) { module.exports = factory(require); }));\n","var util = require('util');\n\n// Error list with code and message\nvar list = {\n\t'empty_input_filepath'\t\t\t\t\t\t\t: { 'code' : 100, 'msg' : 'The input file path can not be empty' }\n  , 'input_filepath_must_be_string'\t\t\t\t\t: { 'code' : 101, 'msg' : 'The input file path must be a string' }\n  , 'invalid_option_name'\t\t\t\t\t\t\t: { 'code' : 102, 'msg' : 'The option \"%s\" is invalid. Check the list of available options' }\n  , 'fileinput_not_exist'\t\t\t\t\t\t\t: { 'code' : 103, 'msg' : 'The input file does not exist' }\n  , 'format_not_supported'\t\t\t\t\t\t\t: { 'code' : 104, 'msg' : 'The format \"$s\" is not supported by the version of ffmpeg' }\n  , 'audio_channel_is_invalid'\t\t\t\t\t\t: { 'code' : 105, 'msg' : 'The audio channel \"$s\" is not valid' }\n  , 'mkdir'\t\t\t\t\t\t\t\t\t\t\t: { 'code' : 106, 'msg' : 'Error occurred during creation folder: $s' }\n  , 'extract_frame_invalid_everyN_options'\t\t\t: { 'code' : 107, 'msg' : 'You can specify only one option between everyNFrames and everyNSeconds' }\n  , 'invalid_watermark'\t\t\t\t\t\t\t\t: { 'code' : 108, 'msg' : 'The watermark \"%s\" does not exists' }\n  , 'invalid_watermark_position'\t\t\t\t\t: { 'code' : 109, 'msg' : 'Invalid watermark position \"%s\"' }\n  , 'size_format'\t\t\t\t\t\t\t\t\t: { 'code' : 110, 'msg' : 'The format \"%s\" not supported by the function \"setSize\"' }\n  , 'resolution_square_not_defined'\t\t\t\t\t: { 'code' : 111, 'msg' : 'The resolution for pixel aspect ratio is not defined' }\n  , 'command_already_exists'\t\t\t\t\t\t: { 'code' : 112, 'msg' : 'The command \"%s\" already exists' }\n  , 'codec_not_supported'\t\t\t\t\t\t\t: { 'code' : 113, 'msg' : 'The codec \"$s\" is not supported by the version of ffmpeg' }\n}\n\n/**\n * Return the error by the codename\n */\nvar renderError = function (codeName) {\n\t// Get the error object by the codename\n\tvar params = [list[codeName].msg];\n\t// Get the possible arguments\n\tif (arguments.length > 1)\n\t\tparams = params.concat(Array.prototype.slice.call(arguments, 1));\n\t// Call the function for replace the letter '%s' with the found arguments\n\treturn { 'code' : list[codeName].code, 'msg' : util.format.apply(this, params) };\n}\n\nmodule.exports.list = list;\nmodule.exports.renderError = renderError;"],"sourceRoot":""}